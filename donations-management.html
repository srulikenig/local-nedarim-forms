<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="he-IL" translate="no">

<head>
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, minimal-ui" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta charset="UTF-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="robots" content="noindex" />

    <link rel="preload" as="image" href="waitnew.gif">
    <link href="https://fonts.googleapis.com/css?family=Assistant:400,600,700&display=swap&subset=hebrew"
        rel="stylesheet" />
    <link rel="stylesheet" href="Files/signature-pad.css" />
    <link rel="stylesheet" type="text/css" href="Files/sweetalert.css?0" />

    <script src="Files/sweetalert.min.js"></script>
    <script type="text/javascript" src="Files/jquery-1.10.2.js"></script>
    <script type="text/javascript" src="Files/jquery-ui.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">

    <title>ניהול תרומות ותורמים - נדרים פלוס</title>

    <style>
        * {
            font-family: 'Assistant', Arial, sans-serif;
        }

        @media screen and (max-width: 400px) {
            .DivTelText {
                width: 80% !important
            }
        }

        @media screen and (max-width: 500px) {
            #MainForm {
                margin-right: 0px !important
            }
        }

        .TextBox {
            -webkit-appearance: none;
            font-size: large;
            color: #3f475e;
            text-align: right;
            padding: 6px;
            border-color: #f7bb4d;
            border-style: solid;
            border-width: 0px 0px 2px 0px;
            margin: 5px 5px;
            background-color: #FFFFFB;
            -webkit-box-sizing: border-box
        }

        .RadioBtLbl {
            border-style: solid;
            border-color: #f7bb4d;
            border-width: 0px 0px 2px 0px;
            margin: 0px 10px;
            background-color: #FFFFFB;
            padding: 10px 2px 10px 10px;
            border-radius: 2px;
            -webkit-user-select: none;
            cursor: pointer;
            display: inline-block;
        }


        .SelectValLbl {
            border-style: solid;
            width: 90%;
            text-align-last: center;
            border-color: #f7bb4d;
            border-width: 0px 0px 2px 0px;
            font-size: large;
            color: #3f475e;
            margin: 0px 5px;
            background-color: #FFFFFB;
            padding: 7px 2px 10px 10px;
            border-radius: 2px;
            -webkit-user-select: none;
            cursor: pointer;
            display: inline-block;
            outline: none;
        }

        .Koteret {
            font-size: 22px;
            color: #2B3A63;
            font-weight: bold;
            text-align: right;
            padding-right: 27px;
            width: 90%;
            margin-top: 27px;
            margin-bottom: 10px;
            -webkit-user-select: none;
        }


        li {
            text-align: right;
            padding: 0px 0px 0px 25px;
            font-size: 17px;
            -webkit-user-select: none;
        }

        .checkbox {
            text-align: right;
            color: #2B3A63;
            padding: 0px 0px 0px 25px;
            font-size: 17px;
        }



        textarea:focus,
        input[type=text]:focus,
        input[type=tel]:focus {
            outline: none;
            border-width: 0px 0px 2px 0px;
            border-color: #38c232
        }

        .Bt {
            -webkit-appearance: none;
            font-size: large;
            color: white;
            background-color: #38c232;
            text-align: center;
            padding: 12px 24px 12px 24px;
            border-color: #fff;
            border-style: solid;
            border-width: 2px;
            border-radius: 5px;
            cursor: pointer;
        }


        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.5);
            -webkit-overflow-scrolling: touch;
        }


        .modal-content {
            background-color: #fefefe;
            margin: 50px auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            color: #808080;
            -webkit-box-shadow: 0px 0px 30px 0px rgba(50, 50, 50, 0.75);
            background-color: white;
            max-width: 500px;
            min-width: 200px;
            min-height: 250px;
            border-radius: 20px;
            text-align: center;
        }

        td {
            color: #296c8d;
            font-size: 20px;
            border: 1px solid #d7cece;
            padding-left: 5px;
            padding-right: 5px;
            padding-top: 15px;
            padding-bottom: 15px;
        }

        th {
            min-height: 500px;
            border: 1px solid #d7cece;
            color: #2B3A63;
            font-family: assistant, Arial;
        }

        .bordered td,
        .bordered th {
            border-left: 1px solid #ccc;
            border-top: 1px solid #ccc;
            padding: 5px;
        }

        .TableLightFont {
            font-weight: lighter;
            font-size: 14px;
        }


        table {
            border-collapse: collapse;
            border: 1px solid #d7cece;
            margin-right: auto;
            margin-left: auto;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .TableKoteret {
            text-align: center;
            padding-right: 20px;
            /*background-color: aliceblue;*/
            font-size: 25px;
            color: steelblue;
            /*lightslategrey*/
            font-weight: normal;
        }

        .fieldName {
            display: inline-block;
            text-align: right;
            width: 100%;
            font-size: medium;
            margin-right: 5px;
            color: #808080;
            -webkit-user-select: none;
            margin-right: 10px
        }

        /* סגנונות ספציפיים לתורמים */
        .donor-row {
            display: flex;
            align-items: stretch;
            text-align: right;
            position: relative;
            border-radius: 5px;
            margin: 5px auto;
            font-size: 15px;
            box-sizing: border-box;
            border: 2px solid #e7e7e7;
            overflow: hidden;
            height: 50px;
            transition: background 0.2s, border 0.2s;
            cursor: pointer;
        }

        .donor-row:hover {
            background: #e3f2fd;
        }

        .donor-row.donated {
            opacity: 0.6;
            background: #f5f5f5;
            border-color: #d0d0d0;
            cursor: default;
        }

        .donor-row.donated:hover {
            background: #f5f5f5;
        }

        .donor-info {
            flex: 1;
            padding: 8px 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .donor-name {
            font-weight: bold;
            font-size: 16px;
            color: #2B3A63;
        }

        .donor-note {
            font-size: 13px;
            color: #666;
            margin-top: 2px;
        }

        .donor-amount {
            background: #4db6ac;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
            font-weight: bold;
            font-size: 14px;
            height: 100%;
        }

        .donor-amount.donated {
            background: #9e9e9e;
        }

        /* לחצני פעולה */
        .action-buttons {
            display: flex;
            flex-direction: row;
            height: 100%;
            min-width: 80px;
        }

        .action-button {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 9px;
            color: white;
            font-weight: bold;
            padding: 2px;
            border: none;
            outline: none;
            border-left: 1px solid rgba(255, 255, 255, 0.3);
        }

        .action-button:first-child {
            border-left: none;
        }

        .action-button.not-available {
            background: #ff8a65;
        }

        .action-button.not-available:hover {
            background: #ff7043;
        }

        .action-button.available {
            background: #4db6ac;
        }

        .action-button.available:hover {
            background: #26a69a;
        }

        .action-button i {
            font-size: 12px;
            margin-bottom: 2px;
        }

        /* סטטוס כנס */
        .status-display {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            min-width: 35px;
            font-size: 10px;
            font-weight: bold;
            color: white;
            text-align: center;
            padding: 2px;
        }

        .status-arrived {
            background: #e8f5e8;
            color: #2e7d32;
            border-right: 4px solid #2B3A63;
        }

        .status-not-arrived {
            background: #ffeaea;
            color: #c62828;
            border-right: 4px solid #2B3A63;
        }

        .back-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2B3A63;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            display: none;
        }

        .back-button:hover {
            background: #1e2a4a;
        }

        /* סטיילים לטוגול בוטון */
        .toggle-button {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0 2px;
        }

        .toggle-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .toggle-container {
            background: #f0f0f0;
            border-radius: 25px;
            padding: 3px;
            display: inline-flex;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* סטיילים למסך iframe */
        #IframeScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }

        #IframeScreen .close-iframe-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1001;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 18px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            transition: background-color 0.2s;
        }

        #IframeScreen .close-iframe-btn:hover {
            background: #ff5252;
        }
    </style>

    <script type="text/javascript">
        // משתנים גלובליים
        var donorsList = [];
        var selectedDonor = null;
        var paymentFieldsArray = [];
        var deviceHolderName = "";
        var messagesList = [];
        var viewMode = 'my'; // 'my' = התורמים שלי, 'all' = כל התורמים
        var searchTerm = ''; // מונח החיפוש הנוכחי
        var is_pos = undefined;
        var PosNedarim = {};

        try {
            var Json = JSON.parse(PosNedarim.GetDevicesStatus());
            is_pos = true;
        } catch (err) {
            is_pos = false;
        }

        // טעינת רשימת תורמים מהשרת
        function loadDonors() {
            showLoading(); // הצגת לאודינג
            var MasofId = GetURLParameter("MasofId");
            $.ajax({
                url: "https://us-central1-hatrama-k.cloudfunctions.net/posApi/donors", // להחליף לכתובת השרת שלך
                method: "POST",
                data: {
                    posNedarim: PosNedarim,
                    viewMode: viewMode, // שליחת מצב התצוגה לשרת
                    masofId: MasofId // שליחת מזהה המכשיר

                },
                timeout: 16000,
                headers: {
                    "Content-Type": "application/json"
                }
            }).success(function (response) {
                hideLoading(); // הסתרת לאודינג
                if (response.status === 'success') {
                    donorsList = response.data.donors || response.data;
                    deviceHolderName = response.data.deviceHolderName || "";
                    messagesList = response.data.messages || [];
                    displayDonors();
                } else if (response.statusCode == 2) {
                    MySwal("שגיאה בקבלת נתונים: " + response.message);
                    displayDeviceError(response.masofId)
                } else {
                    MySwal("שגיאה בקבלת נתונים: " + response.message);
                }
            }).error(function () {
                hideLoading(); // הסתרת לאודינג גם במקרה של שגיאה
                // MySwal("שגיאה בקבלת נתונים: " + response.message);
                // displayGeneralError("שגיאה בטעינת הנתונים")
                // הצגת הודעת שגיאה במקום נתוני דמו
                // displayDeviceError();

                // נתונים לדוגמה למקרה של פיתוח - כרגע מוסתר
                loadSampleData();
            });
        }

        // הצגת הודעת שגיאה כשהמכשיר לא מוגדר
        function displayDeviceError(deviceId) {
            var deviceId = deviceId || "XXX"; // מספר מכשיר לדוגמה - יש לקבל מהשרת או מהמערכת

            var errorHtml = '<div style="display: flex; align-items: center; justify-content: center; min-height: 70vh; padding: 20px; box-sizing: border-box;">';
            errorHtml += '<div style="text-align: center; background-color: white; border-radius: 10px; padding: 40px 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); max-width: 400px; width: 100%; box-sizing: border-box;">';

            // אייקון שגיאה
            errorHtml += '<div style="margin-bottom: 20px;">';
            errorHtml += '<i class="fa fa-exclamation-triangle" style="font-size: 60px; color: #ff6b6b; margin-bottom: 10px;"></i>';
            errorHtml += '</div>';

            // הודעת שגיאה
            errorHtml += '<div style="color: #2B3A63; font-size: 20px; font-weight: bold; margin-bottom: 15px; line-height: 1.4;">מספר מכשיר לא מוגדר</div>';
            errorHtml += '<div style="color: #666; font-size: 16px; margin-bottom: 20px; line-height: 1.4;">להגדרה פנה לאחראי</div>';

            // מספר מכשיר
            errorHtml += '<div style="background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 15px; margin-bottom: 25px;">';
            errorHtml += '<div style="color: #495057; font-size: 14px; margin-bottom: 5px;">מספר מכשיר:</div>';
            errorHtml += '<div style="color: #2B3A63; font-size: 18px; font-weight: bold; font-family: monospace;">' + deviceId + '</div>';
            errorHtml += '</div>';

            // כפתור לטעינת נתוני דמו (למצב פיתוח)
            // errorHtml += '<button onclick="loadSampleData()" style="background-color: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px; margin-top: 10px; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor=\'#5a6268\'" onmouseout="this.style.backgroundColor=\'#6c757d\'">טעינת נתוני דמו</button>';

            errorHtml += '</div>';
            errorHtml += '</div>';

            $("#DonorsListContainer").html(errorHtml);
        }

        // הצגת הודעת שגיאה כללית עם לחצן רענון
        function displayGeneralError(errorMessage, subMessage) {
            var errorMessage = errorMessage || "אירעה שגיאה בטעינת הנתונים";
            var subMessage = subMessage || "אנא נסה שוב";

            var errorHtml = '<div style="display: flex; align-items: center; justify-content: center; min-height: 70vh; padding: 20px; box-sizing: border-box;">';
            errorHtml += '<div style="text-align: center; background-color: white; border-radius: 10px; padding: 40px 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); max-width: 400px; width: 100%; box-sizing: border-box;">';

            // אייקון שגיאה
            errorHtml += '<div style="margin-bottom: 20px;">';
            errorHtml += '<i class="fa fa-exclamation-circle" style="font-size: 60px; color: #ff6b6b; margin-bottom: 10px;"></i>';
            errorHtml += '</div>';

            // הודעת שגיאה
            errorHtml += '<div style="color: #2B3A63; font-size: 20px; font-weight: bold; margin-bottom: 15px; line-height: 1.4;">' + errorMessage + '</div>';
            errorHtml += '<div style="color: #666; font-size: 16px; margin-bottom: 25px; line-height: 1.4;">' + subMessage + '</div>';

            // כפתור רענון
            errorHtml += '<button onclick="ReloadPOS()" style="background-color: #2B3A63; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; transition: background-color 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.2);" onmouseover="this.style.backgroundColor=\'#1e2a4a\'" onmouseout="this.style.backgroundColor=\'#2B3A63\'">רענן עמוד</button>';

            errorHtml += '</div>';
            errorHtml += '</div>';

            $("#DonorsListContainer").html(errorHtml);
        }

        // פונקציות לטיפול בלאודינג
        // השימוש: showLoading() להצגת לאודינג, hideLoading() להסתרת לאודינג
        function showLoading() {
            $("#FixedWaiting").show();
            FixedWaitingStyle();
        }

        function hideLoading() {
            $("#FixedWaiting").hide();
        }

        function FixedWaitingStyle() {
            if ($('#FixedWaiting').length) {
                $('#FixedWaiting img').css('top', (($(window).height()) / 2) - ($('#FixedWaiting img').height() / 2));
                $('#FixedWaiting img').css('left', (($('#FixedWaiting').width()) / 2) - ($('#FixedWaiting img').width() / 2));
            }
        }

        // נתונים לדוגמה (לפיתוח)
        function loadSampleData() {
            deviceHolderName = "יוסי כהן";
            messagesList = [
                { type: 'info', text: 'מתרים יקר! זכור, עניי השכונה זקוקים לעזרתך' },
                { type: 'info', text: 'לבעיות טכניות פנו למספר: 03-1234567' }
            ];
            donorsList = [
                {
                    id: 1,
                    name: "יהודה כהן",
                    note: "מתלבט אם לתרום 180 או 250 לחודש",
                    hasDonated: false,
                    donationAmount: 0,
                    statusKenes: null
                },
                {
                    id: 2,
                    name: "שלמה חיים לוי",
                    note: "",
                    hasDonated: false,
                    donationAmount: 0,
                    statusKenes: 1
                },
                {
                    id: 3,
                    name: "דוד רוזן",
                    note: "מאוד רציני לגשת אליו ראשון",
                    hasDonated: true,
                    donationAmount: 500,
                    statusKenes: 2
                },
                {
                    id: 4,
                    name: "רפאל שמידט",
                    note: "",
                    hasDonated: true,
                    donationAmount: 1200,
                    statusKenes: 3
                },
                {
                    id: 5,
                    name: "אברהם גולדברג",
                    note: "כבר חודשים מחכה לזכות לתרום",
                    hasDonated: false,
                    donationAmount: 0,
                    statusKenes: 3
                }
            ];
            displayDonors();
        }

        // הצגת רשימת התורמים
        function displayDonors() {
            var availableDonors = donorsList.filter(function (donor) {
                return !donor.hasDonated && matchesSearch(donor);
            });
            var donatedDonors = donorsList.filter(function (donor) {
                return donor.hasDonated && matchesSearch(donor);
            });

            var html = '';

            // הצגת שם המחזיק במכשיר - אלמנט נפרד מחוץ לדיב הראשי
            if (deviceHolderName) {
                html += '<div style="text-align: center; font-size: 18px; font-weight: bold; color: #2B3A63; margin: 10px auto 10px; padding: 10px; background-color: #f8f9fa; border-radius: 5px; border: 1px solid #dee2e6; width: 98%; max-width: 500px; box-sizing: border-box;">מתרים: ' + deviceHolderName + '</div>';
            }

            // תחילת הדיב הראשי הלבן
            html += '<div style="text-align: right; background-color: white; border-radius: 5px; margin: 10px auto; width: 98%; max-width: 500px; padding: 15px 10px 20px; box-sizing: border-box;">';

            // כותרת תורמים זמינים
            var viewModeText = viewMode === 'my' ? 'התורמים שלי' : 'כל התורמים';
            html += '<div style="text-align: center; font-size: 22px; font-weight: bold; color: #2B3A63; margin: 5px 0;">תורמים</div>';

            // טוגל בוטון לבחירת סוג התצוגה ואינפוט חיפוש
            html += '<div style="display: flex; justify-content: space-between; align-items: center; margin: 10px 0; gap: 10px;">';

            // אינפוט חיפוש בצד ימין
            html += '<div style="flex: 1; max-width: 200px; position: relative;">';
            html += '<input type="text" id="donorSearch" placeholder="חיפוש תורם..." oninput="filterDonors()" onkeyup="filterDonors()" onpaste="setTimeout(filterDonors, 10)" style="width: 100%; padding: 8px 30px 8px 12px; border: 1px solid #ddd; border-radius: 20px; font-size: 14px; text-align: right; background: #f9f9f9; outline: none; transition: all 0.3s; box-sizing: border-box;" onfocus="this.style.borderColor=\'#2B3A63\'; this.style.background=\'white\';" onblur="this.style.borderColor=\'#ddd\'; this.style.background=\'#f9f9f9\';">';
            html += '<button onclick="clearSearch()" style="position: absolute; left: 8px; top: 50%; transform: translateY(-50%); border: none; background: none; color: #999; cursor: pointer; font-size: 16px; padding: 0; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;" title="נקה חיפוש"><i class="fa fa-times"></i></button>';
            html += '</div>';

            // טוגל בוטון בצד שמאל
            html += '<div class="toggle-container">';
            html += '<button id="viewMyDonors" class="toggle-button" onclick="toggleViewMode(\'my\')" style="color: ' + (viewMode === 'my' ? 'white' : '#666') + '; background: ' + (viewMode === 'my' ? '#2B3A63' : 'transparent') + ';">התורמים שלי</button>';
            html += '<button id="viewAllDonors" class="toggle-button" onclick="toggleViewMode(\'all\')" style="color: ' + (viewMode === 'all' ? 'white' : '#666') + '; background: ' + (viewMode === 'all' ? '#2B3A63' : 'transparent') + ';">כל התורמים</button>';
            html += '</div>';

            html += '</div>';


            // תורמים זמינים
            html += '<div id="AvailableDonorsList">';
            if (availableDonors.length === 0) {
                html += '<div style="text-align:center; color:#2B3A63; font-size:15px; padding:20px 0;">אין תורמים זמינים</div>';
            } else {
                for (var i = 0; i < availableDonors.length; i++) {
                    html += renderDonorRow(availableDonors[i], false);
                }
            }
            html += '</div>';

            // קו מפריד
            html += '<div style="margin: 25px 0 15px 0; display: flex; align-items: center;">'
                + '<hr style="flex:1; border:none; border-top:2px solid #e0e0e0; margin:0 10px;">'
                + '<span style="color:#888; font-size:16px; background:#fff; padding:0 15px; font-weight: bold;">כבר תרמו</span>'
                + '<hr style="flex:1; border:none; border-top:2px solid #e0e0e0; margin:0 10px;">'
                + '</div>';

            // תורמים שכבר תרמו
            html += '<div id="DonatedDonorsList">';
            if (donatedDonors.length === 0) {
                html += '<div style="text-align:center; color:#2B3A63; font-size:15px; padding:10px 0;">אין תורמים שתרמו</div>';
            } else {
                for (var j = 0; j < donatedDonors.length; j++) {
                    html += renderDonorRow(donatedDonors[j], true);
                }
            }
            html += '</div>';

            // הצגת הודעות ישירות באלמנט
            if (messagesList && messagesList.length > 0) {
                html += '<div style="margin: 25px 0px 10px; padding: 15px;  border: 1px solid #bee5eb; border-radius: 5px;">';
                html += '<div style="font-weight: bold; color: #0c5460; margin-bottom: 10px; text-align: center;">הודעות חשובות</div>';
                for (var k = 0; k < messagesList.length; k++) {
                    var message = messagesList[k];
                    var messageClass = '';
                    var iconClass = '';

                    switch (message.type) {
                        case 'error':
                            messageClass = 'color: #dc3545; background-color: #f8d7da; border-color: #f5c6cb;';
                            iconClass = 'fa-exclamation-triangle';
                            break;
                        case 'warning':
                            messageClass = 'color: #856404; background-color: #fff3cd; border-color: #ffeaa7;';
                            iconClass = 'fa-exclamation-circle';
                            break;
                        case 'success':
                            messageClass = 'color: #155724; background-color: #d4edda; border-color: #c3e6cb;';
                            iconClass = 'fa-check-circle';
                            break;
                        default:
                            messageClass = 'color: #0c5460; background-color: #d1ecf1; border-color: #bee5eb;';
                            iconClass = 'fa-info-circle';
                            break;
                    }

                    html += '<div style="margin: 5px 0; padding: 10px; border: 1px solid; border-radius: 5px; ' + messageClass + '">';
                    html += '<i class="fa ' + iconClass + '" style="margin-left: 8px;"></i>';
                    html += message.text;
                    html += '</div>';
                }
                html += '</div>';
            }

            html += '</div>';

            $("#DonorsListContainer").html(html);

            // שמירת מונח החיפוש אחרי רענון התצוגה
            if (searchTerm) {
                $("#donorSearch").val(searchTerm);
                // אם יש מונח חיפוש, הפעל את הסינון
                filterDonorsDisplay();
            }

            // הוספת אירועי לחיצה רק לתורמים זמינים - רק על האזור של המידע
            $("#AvailableDonorsList .donor-row .donor-info").off("click").on("click", function () {
                var donorId = parseInt($(this).parent().data('donor-id'));
                var donor = donorsList.find(function (d) { return d.id === donorId; });
                if (donor && !donor.hasDonated) {
                    openDonationForm(donor);
                }
            });
        }

        // הצגת הודעות מהשרת (לא בשימוש - ההודעות מוצגות ב-displayDonors)
        function displayMessages() {
            // פונקציה זו לא בשימוש - ההודעות מוצגות ישירות ב-displayDonors
        }

        // יצירת שורת תורם
        function renderDonorRow(donor, isDonated) {
            var html = '';
            var additionalClass = isDonated ? ' donated' : '';
            var rowStyle = '';
            var actionContent = '';

            if (isDonated) {
                // תורם שכבר תרם - רקע רגיל עם סכום
                rowStyle = '';
                actionContent = '<div class="donor-amount donated" style="background: #9e9e9e;">₪' + donor.donationAmount + '</div>';
            } else {
                // תורם זמין - רקע כחול בהיר
                rowStyle = 'background-color: #e3f2fd; border-color: #2B3A63;';

                // בדיקת סטטוס כנס
                var statusKenes = donor.statusKenes;
                if (statusKenes === 2) {
                    // הגיע לכנס
                    actionContent = '<div class="status-display status-arrived">' +
                        '<div style="display: flex; flex-direction: column; align-items: center;">' +
                        '<i class="fa fa-check" style="font-size: 10px; margin-bottom: 1px;"></i>' +
                        '<span>הגיע</span>' +
                        '</div>' +
                        '</div>';
                } else if (statusKenes === 3) {
                    // לא הגיע לכנס
                    actionContent = '<div class="status-display status-not-arrived">' +
                        '<div style="display: flex; flex-direction: column; align-items: center;">' +
                        '<i class="fa fa-times" style="font-size: 10px; margin-bottom: 1px;"></i>' +
                        '<span>לא הגיע</span>' +
                        '</div>' +
                        '</div>';
                } else {
                    // statusKenes הוא null או 1 - הצג לחצנים
                    actionContent = '<div class="action-buttons">' +
                        '<button class="action-button not-available" onclick="updateDonorStatus(' + donor.id + ', \'not_available\', event)" title="לא מגיע">' +
                        '<i class="fa fa-times"></i>' +
                        '<span>לא מגיע</span>' +
                        '</button>' +
                        '<button class="action-button available" onclick="updateDonorStatus(' + donor.id + ', \'available\', event)" title="מגיע">' +
                        '<i class="fa fa-check"></i>' +
                        '<span>מגיע</span>' +
                        '</button>' +
                        '</div>';
                }
            }

            html += '<div class="donor-row' + additionalClass + '" data-donor-id="' + donor.id + '" style="' + rowStyle + '">';
            html += '<div class="donor-info">';
            html += '<div class="donor-name">' + (donor.name || '') + '</div>';
            if (donor.note) {
                html += '<div class="donor-note">' + donor.note + '</div>';
            }
            html += '</div>';
            html += actionContent;
            html += '</div>';
            return html;
        }

        // פתיחת טופס תרומה
        function openDonationForm(donor) {
            selectedDonor = donor;
            $("#DonorsScreen").hide();
            $("#DonationScreen").show();
            $(".back-button").show();

            // עדכון כותרת עם שם התורם
            $("#DonorNameTitle").text(donor.name);

            // בניית שדות התשלום
            buildPaymentFields();
        }

        // חזרה למסך התורמים
        function backToDonors() {
            selectedDonor = null;
            $("#DonationScreen").hide();
            $("#IframeScreen").hide(); // גם סגירת iframe אם פתוח
            $(".back-button").hide();
            $("#DonorsScreen").show();

            // איפוס הטופס
            $("#PaymentForm").html('');
            $("#SubmitDiv").show();
            $("#WaitDiv").hide();
            
            // איפוס ה-iframe
            $("#MainIframe").attr("src", "");
        }

        // בניית שדות תשלום מתוך מערך
        function buildFieldsFromArray(fieldsArray, targetElement) {
            if (!fieldsArray || !Array.isArray(fieldsArray)) {
                console.error('fieldsArray must be an array');
                return;
            }

            var html = '';

            for (var i = 0; i < fieldsArray.length; i++) {
                var field = fieldsArray[i];

                if (field.Type === "Koteret") {
                    html += '<div class="Koteret" style="' + (field.Style || '') + '">' + field.Text + '</div>';
                }
                else if (field.Type === "Text" || field.Type === "Tel") {
                    var dir = field.Type === "Tel" ? "ltr" : "rtl";
                    var onInput = field.Type === "Tel" ? 'oninput="OnlyNumber(this.id)"' : '';
                    var mandatory = field.Mandatory ? '<span style="color:indianred;">*</span>' : '';

                    html += '<div class="DivTelText" id="' + field.ElementId + 'Div" style="width:' + (field.Width || 90) + '%;display:inline-block;vertical-align:bottom;text-align:right;margin-top:10px;margin-right:20px;">';
                    html += '<label for="' + field.ElementId + '" class="fieldName">' + mandatory + (field.fieldName || '') + '</label><br>';
                    html += '<input class="TextBox" dir="' + dir + '" autocomplete="off" type="' + field.Type + '" style="width:90%" maxlength="' + (field.MaxLength || 50) + '" id="' + field.ElementId + '" onfocus="ScrollUp(this)" ' + onInput + '/>';
                    html += '</div>';
                }
                else if (field.Type === "Select") {
                    var mandatory = field.Mandatory ? '<span style="color:indianred;">*</span>' : '';
                    html += '<div id="' + field.ElementId + 'Div" style="width:' + (field.Width || 90) + '%;display:inline-block;vertical-align:bottom;text-align:right;margin-top:10px;margin-right:20px;">';
                    html += '<label for="' + field.ElementId + '" class="fieldName">' + mandatory + (field.fieldName || '') + '</label><br>';
                    html += '<select class="SelectValLbl" id="' + field.ElementId + '">';

                    var options = field.SelectVal ? field.SelectVal.split(",") : [""];
                    for (var j = 0; j < options.length; j++) {
                        html += '<option value="' + options[j].replace(/"/g, '&quot;') + '">' + options[j] + '</option>';
                    }
                    html += '</select></div>';
                }
                else if (field.Type === "Radio") {
                    var mandatory = field.Mandatory ? '<span style="color:indianred;">*</span>' : '';
                    html += '<div id="' + field.ElementId + '" style="width:' + (field.Width || 90) + '%;display:inline-block;vertical-align:top;text-align:right;margin: 15px 20px 10px;">';
                    html += '<label class="fieldName">' + mandatory + (field.fieldName || '') + '</label><br>';

                    if (field.RadioBt && Array.isArray(field.RadioBt)) {
                        for (var k = 0; k < field.RadioBt.length; k++) {
                            var radioOption = field.RadioBt[k];
                            html += '<div style="display:inline-block">';
                            html += '<label class="RadioBtLbl" for="' + field.ElementId + '_Radio' + k + '">';
                            html += '<input id="' + field.ElementId + '_Radio' + k + '" type="radio" name="' + field.ElementId + '" value="' + radioOption.Text.replace(/"/g, '&quot;') + '"> ';
                            html += '<span>' + radioOption.Text + '</span>';
                            html += '</label></div>';
                            if (field.br) html += '<br/>';
                        }
                    }
                    html += '</div>';
                }
                else if (field.Type === "CheckBox") {
                    var mandatory = field.Mandatory ? '<span style="color:indianred;">*</span>' : '';
                    html += '<div id="' + field.ElementId + 'Div" class="checkbox" style="width:' + (field.Width || 90) + '%;display:inline-block;vertical-align:top;text-align:right;margin:10px 20px 10px 0px;">';
                    html += '<label for="' + field.ElementId + '">';
                    html += '<input type="CheckBox" id="' + field.ElementId + '"/>';
                    html += mandatory + '<span style="cursor: pointer; width: 90%; display: inline-block; vertical-align: top;padding-right: 3px;">' + (field.fieldName || '') + '</span>';
                    html += '</label></div>';
                }
                else if (field.Type === "textarea") {
                    var mandatory = field.Mandatory ? '<span style="color:indianred;">*</span>' : '';
                    html += '<div id="' + field.ElementId + 'Div" style="width:' + (field.Width || 90) + '%;display:inline-block;vertical-align:top;text-align:right;margin-top:10px;margin-right:20px;">';
                    html += '<label for="' + field.ElementId + '" class="fieldName">' + mandatory + (field.fieldName || '') + '</label><br>';
                    html += '<textarea class="TextBox" rows="' + (field.Rows || 3) + '" dir="rtl" autocomplete="off" style="width:90%;resize:none;" maxlength="' + (field.MaxLength || 500) + '" id="' + field.ElementId + '" onfocus="ScrollUp(this)"></textarea>';
                    html += '</div>';
                }
                else if (field.Type === "Margin") {
                    html += '<div style="height:' + (field.Height || 10) + 'px"></div>';
                }
                else if (field.Type === "Hr") {
                    html += '<hr style="margin-right:20%;margin-left:20%;margin-top:' + (field.MarginTop || 20) + 'px;margin-bottom:' + (field.MarginBottom || 20) + 'px;" >';
                }

                if (field.Br) html += '<br/>';
            }

            $(targetElement).html(html);
        }

        // בניית שדות תשלום
        function buildPaymentFields() {
            // הגדרת מערך שדות התשלום
            paymentFieldsArray = [
                // { "Type": "Margin", "Height": "15" },
                { "Type": "Koteret", "Text": "פרטי התורם" },

                { "ElementId": "DonorFirstName", "MaxLength": 30, "Width": 45, "fieldName": "שם פרטי", "Type": "Text", "Mandatory": false, "Br": false },
                { "ElementId": "DonorLastName", "MaxLength": 30, "Width": 45, "fieldName": "שם משפחה", "Type": "Text", "Mandatory": false, "Br": false },

                { "ElementId": "DonorId", "MaxLength": 9, "Width": 45, "fieldName": "ת.ז.", "Type": "Tel", "Mandatory": false, "Br": false },

                { "ElementId": "DonorPhone", "MaxLength": 11, "Width": 45, "fieldName": "טלפון", "Type": "Tel", "Mandatory": false, "Br": false },
                { "ElementId": "DonorEmail", "MaxLength": 50, "Width": 45, "fieldName": "אימייל", "Type": "Text", "Mandatory": false, "Br": false },

                { "ElementId": "DonorAddress", "MaxLength": 100, "Width": 45, "fieldName": "כתובת", "Type": "Text", "Mandatory": false, "Br": false },

                { "ElementId": "DonationNote", "MaxLength": 500, "Width": 90, "fieldName": "הערות", "Type": "Text", "Rows": 3, "Mandatory": false, "Br": false },

                { "Type": "Margin", "Height": "15" },

                // { "ElementId": "SendReceipt", "fieldName": "שלח קבלה למייל", "Type": "CheckBox", "Mandatory": false, "Width": 90 },
                // { "ElementId": "IsAnonymous", "fieldName": "תרומה אנונימית", "Type": "CheckBox", "Mandatory": false, "Width": 90 }
                { "Type": "Koteret", "Text": "פרטי תרומה" },

                { "ElementId": "DonationAmount", "MaxLength": 10, "Width": 45, "fieldName": "סכום לחודש", "Type": "Tel", "Mandatory": true, "Br": false },
                { "ElementId": "MonthsLimit", "MaxLength": 3, "Width": 45, "fieldName": "הגבלת חודשים - ריק = ללא הגבלה", "fieldNameShow": "הגבלת חודשים<br><span style='font-size:12px;color:#999;'>השאר ריק להו\"ק ללא הגבלה</span>", "Type": "Tel", "Mandatory": false, "Br": false },

                { "Type": "Margin", "Height": "15" },
                { "Type": "Koteret", "Text": "פרטי תשלום" },

                // {
                //     "ElementId": "PaymentMethod", "Width": 90, "fieldName": "אמצעי תשלום", "Type": "Radio", "Mandatory": true, "RadioBt": [
                //         { "Text": "כרטיס אשראי" },
                //         { "Text": "העברה בנקאית" }
                //     ], "Br": false
                // },

                { "Type": "Margin", "Height": "10" },

                { "ElementId": "CreditCard", "MaxLength": 19, "Width": 45, "fieldName": "מספר כרטיס אשראי", "Type": "Tel", "Mandatory": false, "Br": false },
                { "ElementId": "CardExpiration", "MaxLength": 5, "Width": 25, "fieldName": "תוקף", "Type": "Tel", "Mandatory": false, "Br": false },
                { "ElementId": "CVV", "MaxLength": 4, "Width": 25, "fieldName": "CVV", "Type": "Tel", "Mandatory": false, "Br": false },

                // { "ElementId": "CardHolderName", "MaxLength": 50, "Width": 90, "fieldName": "שם בעל הכרטיס", "Type": "Text", "Mandatory": false, "Br": false },
                // { "ElementId": "CardHolderId", "MaxLength": 9, "Width": 45, "fieldName": "ת.ז. בעל הכרטיס", "Type": "Tel", "Mandatory": false, "Br": false },

            ];

            // בניית השדות - כעת הכפתור כבר קיים ב-HTML
            buildFieldsFromArray(paymentFieldsArray, "#PaymentForm");
        }

        // שליחת התרומה
        function submitDonation() {
            MySwal("אין אפשרות לתרום, הטופס בפיתוח");
            return;

            // אפשר להשתמש בלאודינג הגלובלי: showLoading() במקום הקוד הזה
            // showLoading(); 

            if (!selectedDonor) {
                MySwal("שגיאה: לא נבחר תורם");
                return;
            }

            // בדיקת שדות חובה
            var donationAmount = $("#DonationAmount").val();
            if (!donationAmount || donationAmount <= 0) {
                MySwal("נא להזין סכום תרומה");
                $("#DonationAmount").focus();
                return;
            }

            var paymentMethod = $('input[name=PaymentMethod]:checked').val();
            if (!paymentMethod) {
                MySwal("נא לבחור אמצעי תשלום");
                return;
            }

            // הצגת מסך המתנה
            $("#SubmitDiv").hide();
            $("#WaitDiv").show();

            // איסוף הנתונים
            var donationData = {
                donorId: selectedDonor.id,
                donorName: selectedDonor.name,
                amount: donationAmount,
                currency: $("#DonationCurrency").val(),
                paymentMethod: paymentMethod,
                cardNumber: $("#CardNumber").val(),
                cardExpiry: $("#CardExpiry").val(),
                cardCVV: $("#CardCVV").val(),
                cardHolderName: $("#CardHolderName").val(),
                cardHolderId: $("#CardHolderId").val(),
                donorPhone: $("#DonorPhone").val(),
                donorEmail: $("#DonorEmail").val(),
                donorAddress: $("#DonorAddress").val(),
                note: $("#DonationNote").val(),
                sendReceipt: $("#SendReceipt").is(":checked"),
                isAnonymous: $("#IsAnonymous").is(":checked"),
                timestamp: new Date().toISOString()
            };

            // שליחה לשרת
            $.ajax({
                url: "https://your-server.com/api/donations", // להחליף לכתובת השרת שלך
                method: "POST",
                data: JSON.stringify(donationData),
                contentType: "application/json",
                timeout: 60000
            }).success(function (response) {
                $("#WaitDiv").hide();

                if (response.status === 'success') {
                    // עדכון הסטטוס של התורם
                    selectedDonor.hasDonated = true;
                    selectedDonor.donationAmount = parseFloat(donationAmount);

                    swal({
                        type: "success",
                        title: "התרומה נשלחה בהצלחה!",
                        text: "תרומה בסך " + donationAmount + " " + $("#DonationCurrency").val(),
                        showConfirmButton: true,
                        confirmButtonText: "חזרה לרשימה",
                        allowOutsideClick: false
                    }, function () {
                        backToDonors();
                        displayDonors(); // רענון הרשימה
                    });
                } else {
                    MySwal("שגיאה בשליחת התרומה: " + response.message);
                    $("#SubmitDiv").show();
                }
            }).error(function () {
                $("#WaitDiv").hide();
                $("#SubmitDiv").show();
                MySwal("שגיאה בתקשורת עם השרת");
            });
        }

        // פונקציות עזר
        function MySwal(text, id, type) {
            if (type === "success") {
                swal({
                    type: "success",
                    title: text,
                    showConfirmButton: true,
                    allowOutsideClick: false
                });
            } else {
                swal({
                    type: "error",
                    title: text,
                    showConfirmButton: true,
                    allowOutsideClick: false
                }, function () {
                    if (id) {
                        $('#' + id).focus();
                        $('#' + id).select();
                    }
                });
            }
        }

        function OnlyNumber(id) {
            var value = $("#" + id).val();
            $("#" + id).val(value.replace(/[^0-9]/g, ''));
        }

        function ScrollUp(element) {
            $('html, body').animate({ scrollTop: $(element).position().top - 200 }, 'slow');
        }

        // פונקציה להחלפת מצב התצוגה
        function toggleViewMode(mode) {
            viewMode = mode;

            // הצגת הודעה למשתמש על המצב החדש
            var modeText = mode === 'my' ? 'התורמים שלי' : 'כל התורמים';
            console.log('מחליף למצב: ' + modeText);

            loadDonors(); // רענון הנתונים עם המצב החדש
        }

        // פונקציה לסינון התורמים לפי חיפוש - ללא רענון HTML
        function filterDonors() {
            var currentSearchTerm = $("#donorSearch").val().toLowerCase();
            searchTerm = currentSearchTerm;

            // סינון בלי לבנות מחדש את כל ה-HTML
            filterDonorsDisplay();
        }

        // פונקציה לסינון התצוגה ללא בניית HTML מחדש
        function filterDonorsDisplay() {
            // סינון תורמים זמינים
            var availableCount = 0;
            $("#AvailableDonorsList .donor-row").each(function () {
                var donorId = parseInt($(this).data('donor-id'));
                var donor = donorsList.find(function (d) { return d.id === donorId; });

                if (donor && matchesSearch(donor)) {
                    $(this).show();
                    availableCount++;
                } else {
                    $(this).hide();
                }
            });

            // סינון תורמים שתרמו
            var donatedCount = 0;
            $("#DonatedDonorsList .donor-row").each(function () {
                var donorId = parseInt($(this).data('donor-id'));
                var donor = donorsList.find(function (d) { return d.id === donorId; });

                if (donor && matchesSearch(donor)) {
                    $(this).show();
                    donatedCount++;
                } else {
                    $(this).hide();
                }
            });

            // עדכון הודעות "אין תוצאות"
            updateNoResultsMessages(availableCount, donatedCount);
        }

        // פונקציה לעדכון הודעות "אין תוצאות"
        function updateNoResultsMessages(availableCount, donatedCount) {
            // הודעה לתורמים זמינים
            var availableMsg = $("#AvailableDonorsList .no-results-msg");
            if (availableCount === 0) {
                if (availableMsg.length === 0) {
                    var msgText = searchTerm ?
                        'לא נמצאו תורמים זמינים המתאימים לחיפוש' :
                        'אין תורמים זמינים';
                    $("#AvailableDonorsList").append('<div class="no-results-msg" style="text-align:center; color:#2B3A63; font-size:15px; padding:20px 0;">' + msgText + '</div>');
                }
            } else {
                availableMsg.remove();
            }

            // הודעה לתורמים שתרמו
            var donatedMsg = $("#DonatedDonorsList .no-results-msg");
            if (donatedCount === 0) {
                if (donatedMsg.length === 0) {
                    var msgText = searchTerm ?
                        'לא נמצאו תורמים שתרמו המתאימים לחיפוש' :
                        'אין תורמים שתרמו';
                    $("#DonatedDonorsList").append('<div class="no-results-msg" style="text-align:center; color:#2B3A63; font-size:15px; padding:10px 0;">' + msgText + '</div>');
                }
            } else {
                donatedMsg.remove();
            }
        }

        // פונקציה לניקוי החיפוש
        function clearSearch() {
            $("#donorSearch").val('');
            searchTerm = '';

            // הצגת כל התורמים
            $("#AvailableDonorsList .donor-row").show();
            $("#DonatedDonorsList .donor-row").show();

            // הסרת הודעות "אין תוצאות"
            $(".no-results-msg").remove();

            // הפוקוס נשאר באינפוט
            $("#donorSearch").focus();
        }

        // פונקציה לבדיקה אם תורם עונה על קריטריון החיפוש
        function matchesSearch(donor) {
            if (!searchTerm) return true; // אם אין חיפוש, הצג הכל

            var name = (donor.name || '').toLowerCase();
            var note = (donor.note || '').toLowerCase();

            return name.includes(searchTerm) || note.includes(searchTerm);
        }

        // פונקציה לעדכון סטטוס תורם
        function updateDonorStatus(donorId, status, event) {
            // מניעת פעולת לחיצה על השורה
            event.stopPropagation();

            var donor = donorsList.find(function (d) { return d.id === donorId; });
            if (!donor) {
                MySwal("שגיאה: תורם לא נמצא");
                return;
            }

            var statusText = status === 'available' ? 'מגיע' : 'לא מגיע';
            var confirmMessage = 'האם אתה בטוח שברצונך לסמן את ' + donor.name + ' כ"' + statusText + '"?';

            swal({
                title: "אישור פעולה",
                text: confirmMessage,
                type: "warning",
                showCancelButton: true,
                confirmButtonText: "כן, אני בטוח",
                cancelButtonText: "ביטול",
                closeOnConfirm: false,
                showLoaderOnConfirm: true
            }, function () {
                // שליחה לשרת
                $.ajax({
                    url: "https://us-central1-hatrama-k.cloudfunctions.net/posApi/statusKenes", // להחליף לכתובת השרת שלך
                    method: "POST",
                    data: {
                        donorId: donorId,
                        status: status,
                        timestamp: new Date().toISOString()
                    },
                    contentType: "application/json",
                    timeout: 30000
                }).success(function (response) {
                    if (response.status === 'success') {
                        // עדכון הסטטוס המקומי
                        if (status === 'available') {
                            donor.statusKenes = 2; // הגיע לכנס
                        } else if (status === 'not_available') {
                            donor.statusKenes = 3; // לא הגיע לכנס
                        }

                        swal({
                            title: "הפעולה בוצעה בהצלחה!",
                            text: donor.name + ' סומן כ"' + statusText + '"',
                            type: "success",
                            timer: 2000,
                            showConfirmButton: false
                        });

                        // רענון הנתונים
                        setTimeout(function () {
                            loadDonors();
                        }, 1000);
                    } else {
                        swal("שגיאה!", "שגיאה בעדכון הסטטוס: " + response.message, "error");
                    }
                }).error(function () {
                    // למטרות פיתוח - עדכון הסטטוס המקומי גם במקרה של שגיאה
                    if (status === 'available') {
                        donor.statusKenes = 2; // הגיע לכנס
                    } else if (status === 'not_available') {
                        donor.statusKenes = 3; // לא הגיע לכנס
                    }

                    swal({
                        title: "הפעולה בוצעה בהצלחה!",
                        text: donor.name + ' סומן כ"' + statusText + '" (מצב פיתוח)',
                        type: "success",
                        timer: 2000,
                        showConfirmButton: false
                    });

                    // רענון הנתונים
                    setTimeout(function () {
                        loadDonors();
                    }, 1000);
                });
            });
        }

        function ReloadPOS() {
            if (is_pos == true) {
                PosNedarim.Reload()
            }
            else {
                history.go(0)
            }
        }

        // פונקציות לטיפול ב-iframe
        

        function openIframeWithUrl(url) {
            // הגדרת ה-URL ב-iframe
            $("#MainIframe").attr("src", url);
            
            // הסתרת מסכים אחרים והצגת מסך ה-iframe
            $("#DonorsScreen").hide();
            $("#DonationScreen").hide();
            $("#IframeScreen").show();
            $(".back-button").hide();
        }

        function closeIframe() {
            // הסתרת מסך ה-iframe והצגת מסך התורמים
            $("#IframeScreen").hide();
            $("#DonorsScreen").show();
            
            // איפוס ה-iframe
            $("#MainIframe").attr("src", "");
        }

        // אתחול כשהעמוד נטען
        $(document).ready(function () {
            loadDonors();
        });
    </script>
</head>

<body onresize="FixedWaitingStyle()" dir="rtl" style="background-color: #eee; -webkit-user-select: none; user-select: none;">

    <!-- אלמנט לאודינג -->
    <div id="FixedWaiting"
        style="width: 100%; height: 100vh; top: 0; left: 0; position: fixed; z-index: 101; background: rgba(66 ,66 ,66 ,0.47);display:none;">
        <img style="position: absolute; background: white; border-radius: 20%; top: 423px; left: 267px; width: 75px; height: 75px;"
            src="waitnew.gif" alt="waiting" />
    </div>

    <!-- כפתור חזרה -->
    <button class="back-button" onclick="backToDonors()">
        <i class="fa-solid fa-arrow-right"></i>
    </button>

    <!-- לוגו -->
    <div style="text-align: right;border-radius: 5px;width: 98%;padding: 15px 10px 5px;max-width: 500px;margin: auto;box-sizing: border-box;"
        id="Logo">
        <div style="text-align: center;">
            <img onclick="ReloadPOS()" style="border: 0px solid #f1f1f1; border-radius: 7px; height: 140px;"
                src="https://images.matara.pro/ClientsImages/7003974.jpg" alt="נדרים פלוס" />
        </div>
    </div>

    <!-- מסך רשימת התורמים -->
    <div id="DonorsScreen">
        <div id="DonorsListContainer">
            <!-- הרשימה תיבנה כאן באמצעות JavaScript -->
        </div>
        
        <!-- לחצן לפתיחת iframe -->
        <div style="text-align: center; margin: 20px;">
            <input class="Bt" type="button" value="iframe" onclick="openIframeWithUrl('https://nedar.im/TBIj')" style="background-color: #4db6ac; border-color: #4db6ac;" />
        </div>
    </div>

    <!-- מסך iframe -->
    <div id="IframeScreen" style="display: none;">
        <div style="position: relative; width: 100%; height: 100vh; background: #eee;">
            <!-- כפתור סגירה -->
            <button class="close-iframe-btn" onclick="closeIframe()" title="סגור">
                <i class="fa fa-times"></i>
            </button>
            
            <!-- iframe -->
            <iframe id="MainIframe" src="" style="width: 100%; height: 100%; border: none; background: white;" frameborder="0" allowfullscreen></iframe>
        </div>
    </div>

    <!-- מסך טופס התרומה -->
    <div id="DonationScreen" style="display: none;">
        <div
            style="text-align:right;background-color:white;border-radius:10px;margin-top:10px;width:92%;margin-left:auto;margin-right:auto;padding-bottom:20px;padding-top:20px;max-width:600px">

            <!-- כותרת עם שם התורם -->
            <div style="text-align:center;margin:20px;color:#2B3A63;">
                <h2 style="margin: 0;">תורם: <span id="DonorNameTitle"></span></h2>
            </div>
            <hr style="margin-right:20%;margin-left:20%" />

            <div id="AllMainForm" style="display:block;">
                <!-- טופס פרטי התשלום -->
                <div id="PaymentForm" style="margin-right:20px;margin-top:30px;">
                    <!-- השדות יבנו כאן באמצעות JavaScript -->
                </div>

                <div style="text-align:center;margin:40px" id="SubmitDiv">
                    <input class="Bt" type="button" value="אישור תרומה" onclick="submitDonation()" />
                </div>
                <div style="text-align:center;margin:40px;color:#808080;display:none" id="WaitDiv">
                    <img src="waitnew.gif" style="width:50px;" /><br />שומר נתונים
                </div>

                <div style="height:200px"></div>
            </div>
        </div>
    </div>

    <!-- תמונת אבטחה -->
    <div id="SecurityLogo"
        style="text-align:center;width:98%; max-width:400px;margin-left:auto;margin-right:auto;user-select:none">
        <img src="Files/Pic/Security.PNG" style="width:70%" />
    </div>

    <!-- כותרת תחתונה -->
    <div id="FooterLogo"
        style="text-decoration:none;padding:20px;padding-top:5px;padding-bottom:5px;margin-bottom:20px;color:gray;width: 200px;border-radius:5px;opacity:0.7;margin-left : auto; margin-right: auto;text-align:center;font-size:75%;">
        <img src="nedarim.png" /><br />מופעל באמצעות<br /><strong>נדרים פלוס מבית מטרה הפקות</strong><br />לשיווק
        ותמיכה: 03-7630543<br />
    </div>

    <script type="text/javascript" src="Files/FormsFunction.js"></script>

</body>

</html>