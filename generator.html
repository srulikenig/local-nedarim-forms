<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="he-IL" translate="no">

<head>
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, minimal-ui" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta charset="UTF-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="robots" content="noindex" />

    <link rel="preload" as="image" href="waitnew.gif">
    <link href="https://fonts.googleapis.com/css?family=Assistant:400,600,700&display=swap&subset=hebrew"
        rel="stylesheet" />
    <link rel="stylesheet" href="Files/signature-pad.css" />
    <link rel="stylesheet" type="text/css" href="Files/sweetalert.css?0" />

    <script src="Files/sweetalert.min.js"></script>
    <script type="text/javascript" src="Files/jquery-1.10.2.js"></script>
    <script type="text/javascript" src="Files/jquery-ui.min.js"></script>
    <script type="text/javascript" src="Files/CreditCardReader.js"></script>


    <title>טופס - נדרים פלוס</title>

    <style>
        * {
            font-family: 'Assistant', Arial, sans-serif;
        }

        * {
            box-sizing: border-box;
        }

        @media screen and (max-width: 400px) {
            .DivTelText {
                width: 80% !important
            }
        }

        @media screen and (max-width: 500px) {
            #MainForm {
                margin-right: 0px !important
            }
        }

        .TextBox {
            -webkit-appearance: none;
            font-size: large;
            color: #3f475e;
            text-align: right;
            padding: 6px;
            border-color: #f7bb4d;
            border-style: solid;
            border-width: 0px 0px 2px 0px;
            margin: 5px 5px;
            background-color: #FFFFFB;
            -webkit-box-sizing: border-box
        }

        .RadioBtLbl {
            border-style: solid;
            border-color: #f7bb4d;
            border-width: 0px 0px 2px 0px;
            margin: 0px 10px;
            background-color: #FFFFFB;
            padding: 10px 2px 10px 10px;
            border-radius: 2px;
            -webkit-user-select: none;
            cursor: pointer;
            display: inline-block;
        }

        .RadioBtLbl2 {
            /*white-space: nowrap;*/
            border-style: solid;
            border-color: #f7bb4d;
            border-width: 0px 0px 0px 0px;
            /* font-weight: bold; */
            margin: 0px 10px;
            background-color: #FFFFFB;
            padding: 4px 0px;
            border-radius: 2px;
            font-family: 'Assistant', Arial;
            -webkit-user-select: none;
            cursor: pointer;
            display: inline-block;
        }



        .SelectValLbl {
            border-style: solid;
            width: 90%;
            text-align-last: center;
            border-color: #f7bb4d;
            border-width: 0px 0px 2px 0px;
            font-size: large;
            color: #3f475e;
            margin: 0px 5px;
            background-color: #FFFFFB;
            padding: 7px 2px 10px 10px;
            border-radius: 2px;
            -webkit-user-select: none;
            cursor: pointer;
            display: inline-block;
            outline: none;
        }

        .Koteret {
            font-size: 22px;
            color: #ff6a00;
            font-weight: bold;
            text-align: right;
            padding-right: 27px;
            width: 90%;
            margin-top: 27px;
            margin-bottom: 10px;
            -webkit-user-select: none;
        }


        li {
            text-align: right;
            padding: 0px 0px 0px 25px;
            font-size: 17px;
            -webkit-user-select: none;
        }

        .checkbox {
            text-align: right;
            color: #2B3A63;
            padding: 0px 0px 0px 25px;
            font-size: 17px;
        }



        textarea:focus,
        input[type=text]:focus,
        input[type=tel]:focus {
            outline: none;
            border-width: 0px 0px 2px 0px;
            border-color: #38c232
        }

        .Bt {
            -webkit-appearance: none;
            font-size: large;
            color: white;
            background-color: #38c232;
            text-align: center;
            padding: 12px 24px 12px 24px;
            border-color: #fff;
            border-style: solid;
            border-width: 2px;
            border-radius: 5px;
            cursor: pointer;
        }


        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.5);
            -webkit-overflow-scrolling: touch;
        }


        .modal-content {
            background-color: #fefefe;
            margin: 50px auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            color: #808080;
            -webkit-box-shadow: 0px 0px 30px 0px rgba(50, 50, 50, 0.75);
            background-color: white;
            max-width: 500px;
            min-width: 200px;
            min-height: 250px;
            border-radius: 20px;
            text-align: center;
        }

        td {
            color: #296c8d;
            font-size: 20px;
            border: 1px solid #d7cece;
            padding-left: 5px;
            padding-right: 5px;
            padding-top: 15px;
            padding-bottom: 15px;
        }

        th {
            min-height: 500px;
            border: 1px solid #d7cece;
            color: #2B3A63;
            font-family: assistant, Arial;
        }

        .bordered td,
        .bordered th {
            border-left: 1px solid #ccc;
            border-top: 1px solid #ccc;
            padding: 5px;
        }

        .TableLightFont {
            font-weight: lighter;
            font-size: 14px;
        }


        table {
            border-collapse: collapse;
            border: 1px solid #d7cece;
            margin-right: auto;
            margin-left: auto;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .TableKoteret {
            text-align: center;
            padding-right: 20px;
            /*background-color: aliceblue;*/
            font-size: 25px;
            color: steelblue;
            /*lightslategrey*/
            font-weight: normal;
        }

        .fieldName {
            display: inline-block;
            text-align: right;
            width: 100%;
            font-size: medium;
            margin-right: 5px;
            color: #808080;
            -webkit-user-select: none;
            margin-right: 10px
        }

        /* סגנונות טאבים */
        .tab-container {
            width: 100%;
            margin-bottom: 20px;
            direction: rtl;
        }

        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #ddd;
            margin-bottom: 0;
            direction: rtl;
        }

        .tab-button {
            padding: 12px 20px;
            background-color: #f1f1f1;
            border: none;
            border-top: 2px solid transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: #666;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
            margin: 0;
        }

        .tab-button:hover {
            background-color: #e9e9e9;
            color: #333;
        }

        .tab-button.active {
            background-color: white;
            color: #38c232;
            border-top-color: #38c232;
            border-bottom: 2px solid white;
            margin-bottom: -2px;
        }

        .tab-content {
            display: none;
            padding: 20px 5px;
            background-color: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 8px 8px;
            direction: rtl;
        }

        .tab-content.active {
            display: block;
        }
    </style>
    <script>



        var Json = {
            "FormElements": [



            ],
            "TofesId": "00000",//
            "Version": "",
            "AllowChanges": false,
            "NeedSign": false,
            "PreData": false,
            "MosadId": "NoLogo", //0
            "MainLogo": "", // Files/Pic/000_logo.jpg
            "MainTitle": "מחולל הטפסים",
            "SpecialCheck": "" //Phone:Field; Date:Field; MasavPayment "CreditCardPayment" //Zeout:Field; //Mail:Field8; //CreditCardToken:Max //CheckDouble: //Bank:Field90,Field91,Field92 //CopyMail: //Tokef:Field8

        }


        var MasofId = ''
        var ClientId = '';
        var Zeout = '';
        var OldTofesId = '';
        var Demo = '';
        var SignData = '';
        var CurrentKids = 1;


        var CheckElementId = [];
        var CheckDbName = [];
        var CheckDBFree = [];


        // פונקציה ליצירת אלמנטים מ-JSON
        function CreateFormElements(elementsArray, targetElementId) {
            // איפוס מערכי הבדיקה כדי למנוע כפילויות
            CheckElementId = [];
            CheckDbName = [];

            var FormHTML = '';

            for (var Element in elementsArray) {
                var JsonElement = elementsArray[Element]
                var Style = ""
                if (JsonElement.Style) Style = JsonElement.Style
                if (JsonElement.Type == "Koteret") {
                    FormHTML += '<div class="Koteret" style="' + Style + '">' + JsonElement.Text + '</div>'
                } else {
                    var dir = "rtl"
                    var Bold = ""
                    if (JsonElement.Bold == true) Bold = "font-weight:bold"
                    if (JsonElement.Type == 'Tel') dir = "ltr"
                    var FieldName = JsonElement.fieldName
                    if (JsonElement.fieldNameShow !== undefined) FieldName = JsonElement.fieldNameShow
                    var Lbl = '<label for="' + JsonElement.ElementId + '" class="fieldName" style="' + Bold + ';' + Style + '">' + ((JsonElement.Mandatory == true) ? '<span id="Span_' + JsonElement.ElementId + '" style="color:indianred;">*</span>' : '<span id="Span_' + JsonElement.ElementId + '" style="color:indianred;display:none">*</span>') + FieldName + '</label><br>'
                    if (JsonElement.LblHide == true) Lbl = ''
                    if (JsonElement.Type == "Select") {
                        var DivData = '<div id="' + JsonElement.ElementId + 'Div"  style="width:' + JsonElement.Width + '%;display:inline-block;vertical-align:bottom;text-align:right;margin-top:10px;margin-right:20px;margin-bottom: 4px;' + Style + '">' + Lbl + '<select class="SelectValLbl"  id="' + JsonElement.ElementId + '">'
                        for (i = 0; i < JsonElement.SelectVal.split(",").length; i++) {
                            DivData += '<option value="' + JsonElement.SelectVal.split(",")[i].replace(/"/g, '&quot;') + '"> ' + JsonElement.SelectVal.split(",")[i] + '</option>'
                        }
                        DivData += '</select></div>'
                        FormHTML += DivData
                    }
                    else if (JsonElement.Type == "Margin") {
                        FormHTML += '<div style="height:' + JsonElement.Height + 'px"></div>'
                    }
                    else if (JsonElement.Type == "Hr") {
                        FormHTML += '<hr style="margin-right:20%;margin-left:20%;margin-top:' + JsonElement.MarginTop + 'px;margin-bottom:' + JsonElement.MarginBottom + 'px;' + Style + '" > '
                    }
                    else if (JsonElement.Type == "IndexNumber") {
                        var SpanId = ""
                        if (JsonElement.ElementId !== undefined) SpanId = "id='" + JsonElement.ElementId + "'"
                        FormHTML += (JsonElement.BeforeBr == true ? "<br id='" + JsonElement.ElementId + "Br' />" : '') + '<span ' + SpanId + ' style="-webkit-user-select: none;margin-top:15px;font-weight:bold;font-size:large;display:inline-block;color:#2B3A63;font-family:Assistant;background-color:cadetblue ;padding:3px 6px;color:white;font-weight:normal;border-radius:2px;margin-left: -10px;vertical-align: top;">' + JsonElement.Text + '</span>'
                    } else if (JsonElement.Type == "Div") {
                        FormHTML += '<div  id="' + JsonElement.ElementId + '" style="' + Style + ';' + Bold + '">' + JsonElement.Text + '</div>'
                    }
                    else if (JsonElement.Type == "DivOpen") {
                        FormHTML += '<div  id="' + JsonElement.ElementId + '" style="' + Style + ';' + Bold + '">' + JsonElement.Text
                    }
                    else if (JsonElement.Type == "DivClose") {
                        FormHTML += '</div>'
                    }
                    else if (JsonElement.Type == "List") {
                        FormHTML += '<ol start=' + JsonElement.Number + ' style="-webkit-user-select:none;text-align:right;font-weight: bold;color: #2B3A63;' + (!JsonElement.Number ? 'list-style-type: disc;' : '') + ';' + Style + '"><li>' + JsonElement.Text + '</li></ol>'
                    }
                    else if (JsonElement.Type == "CheckBox") {


                        var FieldName = JsonElement.fieldName
                        if (JsonElement.fieldNameShow !== undefined) FieldName = JsonElement.fieldNameShow
                        FormHTML += '<div id="' + JsonElement.ElementId + 'Div" class="checkbox" style="-webkit-user-select:none;width:' + JsonElement.Width + '%;display:inline-block;vertical-align:top;text-align:right;margin:10px 20px 10px 0px;' + Style + ';' + Bold + '"><label for="' + JsonElement.ElementId + '"><input type="CheckBox" dir="' + dir + '" id="' + JsonElement.ElementId + '"/>' + ((JsonElement.Mandatory == true) ? '<span id="Span_' + JsonElement.ElementId + '" style="color:indianred;">*</span>' : '<span id="Span_' + JsonElement.ElementId + '" style="color:indianred;display:none">*</span>') + '<span id="' + JsonElement.ElementId + '_Txt" style="cursor: pointer; width: 90%; display: inline-block; vertical-align: top;padding-right: 3px;">' + FieldName + '</span></label></div>'
                    }
                    else if (JsonElement.Type == "textarea") {
                        FormHTML += '<div id="' + JsonElement.ElementId + 'Div" style="resize:none;width:' + JsonElement.Width + '%;display:inline-block;vertical-align:top;text-align:right;margin-top:10px;margin-right:20px;' + Style + '">' + Lbl + '<textarea class="TextBox"  rows="' + JsonElement.Rows + '" dir="' + dir + '" autocomplete="off" type="' + JsonElement.Type + '" style="width:90%;resize:none;" maxlength="' + JsonElement.MaxLength + '" id="' + JsonElement.ElementId + '" onfocus="ScrollUp(this)"/></div>'
                    }
                    else if (JsonElement.Type == "Text" || JsonElement.Type == "Tel") {
                        var OnInput = ""
                        if (JsonElement.Type == "Tel") OnInput = 'oninput="OnlyNumber(this.id)"'
                        FormHTML += '<div class="DivTelText" id="' + JsonElement.ElementId + 'Div" style="width:' + JsonElement.Width + '%;display:inline-block;vertical-align:bottom;text-align:right;margin-top:10px;margin-right:20px;">' + Lbl + '<input class="TextBox" dir="' + dir + '" autocomplete="off" type="' + JsonElement.Type + '" style="width:90%" maxlength="' + JsonElement.MaxLength + '" id="' + JsonElement.ElementId + '" onfocus="ScrollUp(this)" ' + OnInput + '/></div>'
                    } else if (JsonElement.Type == "Radio") {
                        var Br = ""
                        if (JsonElement.br == true) Br = "<br/>"

                        if (JsonElement.RadioType == "Radio2") {
                            var DivData = '<div id="' + JsonElement.ElementId + '" style="display:inline-block;vertical-align:top;text-align:right">' + Lbl
                        } else {
                            var DivData = '<div id="' + JsonElement.ElementId + '" style="width:' + JsonElement.Width + '%;display:inline-block;vertical-align:top;text-align:right;margin: 15px 20px 10px;' + Style + '">' + Lbl
                        }

                        for (i = 0; i < JsonElement.RadioBt.length; i++) {
                            var Show = JsonElement.RadioBt[i].Text
                            if (JsonElement.RadioBt[i].Show !== undefined) { Show = JsonElement.RadioBt[i].Show }
                            if (JsonElement.RadioType == "Radio2") {
                                DivData += '<div  id="' + JsonElement.ElementId + '_RadioLbl' + i + '" style="display:inline-block"><label  class="RadioBtLbl2" for="' + JsonElement.ElementId + '_Radio' + i + '" ><input id="' + JsonElement.ElementId + '_Radio' + i + '" type="radio" name="' + JsonElement.ElementId + '" value="' + JsonElement.RadioBt[i].Text.replace(/"/g, '&quot;') + '"> ' + Show + '</label></div><br/>' + Br
                            } else {
                                DivData += '<div id="' + JsonElement.ElementId + '_RadioLbl' + i + '" style="display:inline-block"><label class="RadioBtLbl" for="' + JsonElement.ElementId + '_Radio' + i + '" style="' + Style + ';' + (JsonElement.RadioBt[i].Bold == true ? 'font-weight:bold' : '') + '"><input id="' + JsonElement.ElementId + '_Radio' + i + '" type="radio" name="' + JsonElement.ElementId + '" value="' + JsonElement.RadioBt[i].Text.replace(/"/g, '&quot;') + '"> <span id="' + JsonElement.ElementId + '_RadioLblShow' + i + '">' + Show + '</span></label></div>' + Br
                            }
                        }
                        DivData += '</div>'
                        FormHTML += DivData;

                    }
                    if (JsonElement.Br == true) FormHTML += '<br/>';



                    // בדיקות
                    if (JsonElement.DbName !== undefined) {
                        if (CheckDbName.indexOf(JsonElement.DbName) > -1) { alert("נמצא כפילות DbName ב: " + JsonElement.DbName) }
                        if (JsonElement.DbName.substring(0, 5) != "Field") { alert("לא תקין DbName: " + JsonElement.DbName) }
                        if (JsonElement.DbName.indexOf("Max") > -1) {
                            if ($.isNumeric(JsonElement.DbName.split('Field')[1].split('Max')[0]) == false || JsonElement.DbName.split('Field')[1].split('Max')[1] != "") { alert("לא תקין DbName: " + JsonElement.DbName) }
                            if (JsonElement.DbName.split('Field')[1].split('Max')[0] < 1 || JsonElement.DbName.split('Field')[1].split('Max')[0] > 10) { alert("נמצא חריגה  DbNameMax: " + JsonElement.DbName) }
                        }
                        else if ($.isNumeric(JsonElement.DbName.split('Field')[1]) == false) { alert("לא תקין DbName: " + JsonElement.DbName) }
                        if (parseInt(JsonElement.DbName.split("Field")[1]) > 99) { alert("נמצא חריגה DbName ב: " + JsonElement.DbName) }
                        CheckDbName.push(JsonElement.DbName)
                    }

                    if (JsonElement.ElementId !== undefined) {
                        if (CheckElementId.indexOf(JsonElement.ElementId) > -1) { alert("נמצא כפילות ElementId ב: " + JsonElement.ElementId) }
                        CheckElementId.push(JsonElement.ElementId);
                    }

                    if (JsonElement.ElementId == "CreditCard" || JsonElement.ElementId == "CardExpiration") {
                        if ((Json.SpecialCheck.indexOf("CreditCardPayment") < 0) && (Json.SpecialCheck.indexOf("CreditCardToken") < 0)) { alert("לא קיימת שליחת אשראי.") }
                        if (JsonElement.DbName && JsonElement.ElementId == "CreditCard" && (Json.SpecialCheck.indexOf("CreditCardToken:" + JsonElement.DbName) < 0)) { alert("כרטיס אשראי נשלח ללא CreditCardToken") }
                    }
                }
            }

            // הכנסת התוכן לאלמנט היעד
            $("#" + targetElementId).html(FormHTML);
        }


        var MainForm = '';

        // משתנים ליוצר הטפסים
        var formBuilderElements = [];
        var fieldCounter = 0;

        // פונקציה להוספת שדה חדש
        function addNewField() {
            fieldCounter++;
            var fieldId = 'field_' + fieldCounter;

            var fieldHtml = '<div id="' + fieldId + '" style="border:1px solid #ddd;border-radius:5px;padding:15px;margin-bottom:10px;margin-left:10px;margin-right:10px;background-color:#f9f9f9;">' +
                '<div style="display:flex;align-items:center;margin-bottom:10px;">' +
                '<button onclick="removeField(\'' + fieldId + '\')" style="background-color:#dc3545;color:white;border:none;border-radius:3px;padding:5px 8px;margin-left:10px;cursor:pointer;">' +
                '✖' +
                '</button>' +
                '<select id="' + fieldId + '_type" onchange="updateFieldOptions(\'' + fieldId + '\')" style="padding:5px 10px;border:1px solid #ccc;border-radius:3px;margin-left:10px;">' +
                '<option value="">בחר סוג שדה</option>' +
                '<option value="Koteret">כותרת</option>' +
                '<option value="Hr">קו מפריד</option>' +
                '<option value="Text">טקסט</option>' +
                '<option value="Tel">טלפון</option>' +
                '<option value="textarea">טקסט ארוך</option>' +
                '<option value="Select">תפריט נפתח</option>' +
                '<option value="CheckBox">צ\'קבוקס</option>' +
                '<option value="Radio">רדיו</option>' +
                '<option value="List">רשימה</option>' +
                '</select>' +
                '<span style="font-weight:bold;color:#2B3A63;">שדה #' + fieldCounter + '</span>' +
                '</div>' +
                '<div id="' + fieldId + '_options" style="display:none;">' +
                '<!-- כאן יופיעו האופציות לפי סוג השדה -->' +
                '</div>' +
                '</div>';

            $('#fieldsList').append(fieldHtml);
        }

        // פונקציה להסרת שדה
        function removeField(fieldId) {
            $('#' + fieldId).remove();
            // הסרה מהמערך
            for (var i = 0; i < formBuilderElements.length; i++) {
                if (formBuilderElements[i].fieldId === fieldId) {
                    formBuilderElements.splice(i, 1);
                    break;
                }
            }

            // עדכון המספור של כל השדות הנותרים
            updateFieldNumbers();

            // עדכון הטופס אחרי ההסרה
            setTimeout(generatePreview, 100);
        }

        // פונקציה לעדכון מספור השדות
        function updateFieldNumbers() {
            var counter = 0;
            $('#fieldsList > div').each(function () {
                counter++;
                var fieldId = $(this).attr('id');
                if (fieldId) {
                    // עדכון הטקסט של מספר השדה
                    $(this).find('span[style*="font-weight:bold;color:#2B3A63"]').text('שדה #' + counter);
                }
            });

            // עדכון המספר הכללי של הספירה
            fieldCounter = counter;
        }

        // פונקציה לעדכון אופציות השדה לפי הסוג
        function updateFieldOptions(fieldId) {
            var fieldType = $('#' + fieldId + '_type').val();
            var optionsDiv = $('#' + fieldId + '_options');

            if (fieldType === '') {
                optionsDiv.hide();
                setTimeout(generatePreview, 50);
                return;
            }

            var optionsHtml = '';

            if (fieldType === 'Koteret') {
                optionsHtml = '<div style="margin-bottom:10px;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">תוכן הכותרת:</label>' +
                    '<input type="text" id="' + fieldId + '_text" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="הזן את תוכן הכותרת">' +
                    '</div>';
            } else if (fieldType === 'Hr') {
                optionsHtml = '<div style="display:flex;gap:10px;margin-bottom:10px;">' +
                    '<div style="flex:1;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">רווח עליון (px):</label>' +
                    '<input type="number" id="' + fieldId + '_marginTop" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="10" value="10">' +
                    '</div>' +
                    '<div style="flex:1;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">רווח תחתון (px):</label>' +
                    '<input type="number" id="' + fieldId + '_marginBottom" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="10" value="10">' +
                    '</div>' +
                    '</div>';
            } else if (fieldType === 'Text') {
                optionsHtml = '<div style="margin-bottom:10px;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">שם השדה:</label>' +
                    '<input type="text" id="' + fieldId + '_fieldName" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="הזן את שם השדה">' +
                    '</div>' +
                    '<div style="display:flex;gap:10px;margin-bottom:10px;">' +
                    '<div style="flex:1;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">אורך מקסימלי:</label>' +
                    '<input type="number" id="' + fieldId + '_maxLength" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="50" value="50">' +
                    '</div>' +
                    '<div style="flex:1;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">רוחב (%):</label>' +
                    '<input type="number" id="' + fieldId + '_width" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="40" value="40">' +
                    '</div>' +
                    '</div>' +
                    '<div style="margin-bottom:10px;">' +
                    '<label><input type="checkbox" id="' + fieldId + '_mandatory"> שדה חובה</label>' +
                    '</div>';
            } else if (fieldType === 'Tel') {
                optionsHtml = '<div style="margin-bottom:10px;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">שם השדה:</label>' +
                    '<input type="text" id="' + fieldId + '_fieldName" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="הזן את שם השדה">' +
                    '</div>' +
                    '<div style="display:flex;gap:10px;margin-bottom:10px;">' +
                    '<div style="flex:1;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">אורך מקסימלי:</label>' +
                    '<input type="number" id="' + fieldId + '_maxLength" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="15" value="15">' +
                    '</div>' +
                    '<div style="flex:1;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">רוחב (%):</label>' +
                    '<input type="number" id="' + fieldId + '_width" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="40" value="40">' +
                    '</div>' +
                    '</div>' +
                    '<div style="margin-bottom:10px;">' +
                    '<label><input type="checkbox" id="' + fieldId + '_mandatory"> שדה חובה</label>' +
                    '</div>';
            } else if (fieldType === 'textarea') {
                optionsHtml = '<div style="margin-bottom:10px;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">שם השדה:</label>' +
                    '<input type="text" id="' + fieldId + '_fieldName" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="הזן את שם השדה">' +
                    '</div>' +
                    '<div style="display:flex;gap:10px;margin-bottom:10px;">' +
                    '<div style="flex:1;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">שורות:</label>' +
                    '<input type="number" id="' + fieldId + '_rows" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="3" value="3">' +
                    '</div>' +
                    '<div style="flex:1;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">רוחב (%):</label>' +
                    '<input type="number" id="' + fieldId + '_width" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="80" value="80">' +
                    '</div>' +
                    '</div>' +
                    '<div style="margin-bottom:10px;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">אורך מקסימלי:</label>' +
                    '<input type="number" id="' + fieldId + '_maxLength" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="500" value="500">' +
                    '</div>' +
                    '<div style="margin-bottom:10px;">' +
                    '<label><input type="checkbox" id="' + fieldId + '_mandatory"> שדה חובה</label>' +
                    '</div>';
            } else if (fieldType === 'Select') {
                optionsHtml = '<div style="margin-bottom:10px;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">שם השדה:</label>' +
                    '<input type="text" id="' + fieldId + '_fieldName" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="הזן את שם השדה">' +
                    '</div>' +
                    '<div style="margin-bottom:10px;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">רוחב (%):</label>' +
                    '<input type="number" id="' + fieldId + '_width" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="40" value="40">' +
                    '</div>' +
                    '<div style="margin-bottom:10px;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">אופציות (אחת בכל שורה):</label>' +
                    '<textarea id="' + fieldId + '_options" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;height:80px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="אופציה 1&#10;אופציה 2&#10;אופציה 3"></textarea>' +
                    '</div>' +
                    '<div style="margin-bottom:10px;">' +
                    '<label><input type="checkbox" id="' + fieldId + '_mandatory"> שדה חובה</label>' +
                    '</div>';
            } else if (fieldType === 'CheckBox') {
                optionsHtml = '<div style="margin-bottom:10px;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">תוכן הצ\'קבוקס:</label>' +
                    '<input type="text" id="' + fieldId + '_fieldName" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="הזן את תוכן הצ\'קבוקס">' +
                    '</div>' +
                    '<div style="margin-bottom:10px;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">רוחב (%):</label>' +
                    '<input type="number" id="' + fieldId + '_width" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="40" value="40">' +
                    '</div>' +
                    '<div style="margin-bottom:10px;">' +
                    '<label><input type="checkbox" id="' + fieldId + '_mandatory"> שדה חובה</label>' +
                    '</div>';
            } else if (fieldType === 'Radio') {
                optionsHtml = '<div style="margin-bottom:10px;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">שם השדה:</label>' +
                    '<input type="text" id="' + fieldId + '_fieldName" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="הזן את שם השדה">' +
                    '</div>' +
                    '<div style="margin-bottom:10px;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">רוחב (%):</label>' +
                    '<input type="number" id="' + fieldId + '_width" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="40" value="40">' +
                    '</div>' +
                    '<div style="margin-bottom:10px;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">אופציות (אחת בכל שורה):</label>' +
                    '<textarea id="' + fieldId + '_options" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;height:80px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="אופציה 1&#10;אופציה 2&#10;אופציה 3"></textarea>' +
                    '</div>' +
                    '<div style="margin-bottom:10px;">' +
                    '<label><input type="checkbox" id="' + fieldId + '_mandatory"> שדה חובה</label>' +
                    '</div>';
            } else if (fieldType === 'List') {
                optionsHtml = '<div style="margin-bottom:10px;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">פריטי הרשימה (אחד בכל שורה):</label>' +
                    '<textarea id="' + fieldId + '_listItems" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;height:80px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="פריט 1&#10;פריט 2&#10;פריט 3"></textarea>' +
                    '</div>' +
                    '<div style="margin-bottom:10px;">' +
                    '<label style="display:block;margin-bottom:5px;font-weight:bold;color:#555;">מספר התחלה:</label>' +
                    '<input type="number" id="' + fieldId + '_startNumber" ' +
                    'style="width:calc(100% - 10px);padding:8px;border:1px solid #ccc;border-radius:3px;margin-left:5px;margin-right:5px;" ' +
                    'placeholder="1" value="1">' +
                    '</div>';
            }

            optionsDiv.html(optionsHtml).show();
            
            // עדכון מיידי של התצוגה המקדימה
            setTimeout(generatePreview, 10);
        }

        // פונקציה ליצירת תצוגה מקדימה עם ערך חדש
        function generatePreviewWithNewValue(fieldId, newValue) {
            console.log('generatePreviewWithNewValue called for:', fieldId, 'with value:', newValue);
            
            // עדכון כותרת הטופס
            var formTitle = $('#formTitle').val() || 'מחולל הטפסים';
            Json.MainTitle = formTitle;
            $('#MainTitle').html(formTitle);

            // עדכון הגדרות נוספות
            Json.NeedSign = $('#requireSignature').is(':checked');
            Json.AllowChanges = !$('#requireNedarimLogin').is(':checked');

            // ריענון המערך לפני יצירת התצוגה
            formBuilderElements = [];
            var elementId = 1;

            $('#fieldsList > div').each(function () {
                var currentFieldId = $(this).attr('id');
                if (!currentFieldId) return;

                var fieldType = $('#' + currentFieldId + '_type').val();
                if (!fieldType) return;

                if (fieldType === 'List') {
                    var listItems;
                    if (fieldId === currentFieldId + '_listItems') {
                        listItems = newValue;
                    } else {
                        listItems = $('#' + currentFieldId + '_listItems').val() || 'פריט 1\nפריט 2\nפריט 3';
                    }
                    var itemsArray = listItems.split('\n');
                    var startNumber = parseInt($('#' + currentFieldId + '_startNumber').val()) || 1;

                    for (var i = 0; i < itemsArray.length; i++) {
                        if (itemsArray[i].trim() !== '') {
                            var listElement = {
                                Type: 'List',
                                Text: itemsArray[i].trim(),
                                Number: startNumber + i
                            };
                            formBuilderElements.push(listElement);
                        }
                    }
                } else {
                    var element = { Type: fieldType };

                    if (fieldType === 'Koteret') {
                        element.Text = $('#' + currentFieldId + '_text').val() || 'כותרת חדשה';
                    } else if (fieldType === 'Hr') {
                        element.MarginTop = parseInt($('#' + currentFieldId + '_marginTop').val()) || 10;
                        element.MarginBottom = parseInt($('#' + currentFieldId + '_marginBottom').val()) || 10;
                    } else if (fieldType === 'Text' || fieldType === 'Tel') {
                        element.ElementId = 'Field' + elementId;
                        element.fieldName = $('#' + currentFieldId + '_fieldName').val() || 'שדה חדש';
                        element.MaxLength = parseInt($('#' + currentFieldId + '_maxLength').val()) || (fieldType === 'Tel' ? 15 : 50);
                        element.Width = parseInt($('#' + currentFieldId + '_width').val()) || 40;
                        element.Mandatory = $('#' + currentFieldId + '_mandatory').is(':checked');
                        element.DbName = 'Field' + elementId;
                        elementId++;
                    } else if (fieldType === 'textarea') {
                        element.ElementId = 'Field' + elementId;
                        element.fieldName = $('#' + currentFieldId + '_fieldName').val() || 'שדה טקסט ארוך';
                        element.Rows = parseInt($('#' + currentFieldId + '_rows').val()) || 3;
                        element.Width = parseInt($('#' + currentFieldId + '_width').val()) || 80;
                        element.MaxLength = parseInt($('#' + currentFieldId + '_maxLength').val()) || 500;
                        element.Mandatory = $('#' + currentFieldId + '_mandatory').is(':checked');
                        element.DbName = 'Field' + elementId;
                        elementId++;
                    } else if (fieldType === 'Select') {
                        element.ElementId = 'Field' + elementId;
                        element.fieldName = $('#' + currentFieldId + '_fieldName').val() || 'תפריט נפתח';
                        element.Width = parseInt($('#' + currentFieldId + '_width').val()) || 40;
                        element.Mandatory = $('#' + currentFieldId + '_mandatory').is(':checked');
                        element.DbName = 'Field' + elementId;

                        var optionsText;
                        if (fieldId === currentFieldId + '_options') {
                            optionsText = newValue;
                        } else {
                            optionsText = $('#' + currentFieldId + '_options').val() || 'אופציה 1\nאופציה 2\nאופציה 3';
                        }
                        console.log('Select field:', currentFieldId, 'Options text:', optionsText); // debug
                        // ניקוי שורות ריקות ורווחים מיותרים
                        var cleanOptions = optionsText.split('\n').filter(function(option) {
                            return option.trim() !== '';
                        }).map(function(option) {
                            return option.trim();
                        });
                        element.SelectVal = cleanOptions.join(',');
                        console.log('Select final value:', element.SelectVal); // debug
                        elementId++;
                    } else if (fieldType === 'CheckBox') {
                        element.ElementId = 'Field' + elementId;
                        element.fieldName = $('#' + currentFieldId + '_fieldName').val() || 'צ\'קבוקס חדש';
                        element.Width = parseInt($('#' + currentFieldId + '_width').val()) || 40;
                        element.Mandatory = $('#' + currentFieldId + '_mandatory').is(':checked');
                        element.DbName = 'Field' + elementId;
                        elementId++;
                    } else if (fieldType === 'Radio') {
                        element.ElementId = 'Field' + elementId;
                        element.fieldName = $('#' + currentFieldId + '_fieldName').val() || 'רדיו חדש';
                        element.Width = parseInt($('#' + currentFieldId + '_width').val()) || 40;
                        element.Mandatory = $('#' + currentFieldId + '_mandatory').is(':checked');
                        element.DbName = 'Field' + elementId;
                        element.RadioType = 'Radio2'; // ברירת מחדל להצגה בשורה אחת

                        var optionsText;
                        if (fieldId === currentFieldId + '_options') {
                            optionsText = newValue;
                        } else {
                            optionsText = $('#' + currentFieldId + '_options').val() || 'אופציה 1\nאופציה 2\nאופציה 3';
                        }
                        console.log('Radio field:', currentFieldId, 'Options text:', optionsText); // debug
                        var optionsArray = optionsText.split('\n');
                        element.RadioBt = [];
                        for (var i = 0; i < optionsArray.length; i++) {
                            // בדיקה שהשורה לא ריקה ולא רק רווחים
                            if (optionsArray[i].trim() !== '') {
                                element.RadioBt.push({ Text: optionsArray[i].trim() });
                            }
                        }
                        console.log('Radio final RadioBt:', element.RadioBt); // debug
                        elementId++;
                    }

                    formBuilderElements.push(element);
                }
            });

            if (formBuilderElements.length === 0) {
                $('#MainForm').html('<div style="text-align:center;color:#999;padding:20px;">לא נוספו שדות עדיין</div>');
                return;
            }

            CreateFormElements(formBuilderElements, 'MainForm');
        }

        // פונקציה ליצירת תצוגה מקדימה
        function generatePreview() {
            // עדכון כותרת הטופס
            var formTitle = $('#formTitle').val() || 'מחולל הטפסים';
            Json.MainTitle = formTitle;
            $('#MainTitle').html(formTitle);

            // עדכון הגדרות נוספות
            Json.NeedSign = $('#requireSignature').is(':checked');
            Json.AllowChanges = !$('#requireNedarimLogin').is(':checked'); // אם נדרש חשבון נדרים, לא מותר שינויים

            // ריענון המערך לפני יצירת התצוגה
            formBuilderElements = [];
            var elementId = 1;

            $('#fieldsList > div').each(function () {
                var fieldId = $(this).attr('id');
                if (!fieldId) return;

                var fieldType = $('#' + fieldId + '_type').val();
                if (!fieldType) return;

                if (fieldType === 'List') {
                    var listItems = $('#' + fieldId + '_listItems').val() || 'פריט 1\nפריט 2\nפριט 3';
                    var itemsArray = listItems.split('\n');
                    var startNumber = parseInt($('#' + fieldId + '_startNumber').val()) || 1;

                    for (var i = 0; i < itemsArray.length; i++) {
                        if (itemsArray[i].trim() !== '') {
                            var listElement = {
                                Type: 'List',
                                Text: itemsArray[i].trim(),
                                Number: startNumber + i
                            };
                            formBuilderElements.push(listElement);
                        }
                    }
                } else {
                    var element = { Type: fieldType };

                    if (fieldType === 'Koteret') {
                        element.Text = $('#' + fieldId + '_text').val() || 'כותרת חדשה';
                    } else if (fieldType === 'Hr') {
                        element.MarginTop = parseInt($('#' + fieldId + '_marginTop').val()) || 10;
                        element.MarginBottom = parseInt($('#' + fieldId + '_marginBottom').val()) || 10;
                    } else if (fieldType === 'Text' || fieldType === 'Tel') {
                        element.ElementId = 'Field' + elementId;
                        element.fieldName = $('#' + fieldId + '_fieldName').val() || 'שדה חדש';
                        element.MaxLength = parseInt($('#' + fieldId + '_maxLength').val()) || (fieldType === 'Tel' ? 15 : 50);
                        element.Width = parseInt($('#' + fieldId + '_width').val()) || 40;
                        element.Mandatory = $('#' + fieldId + '_mandatory').is(':checked');
                        element.DbName = 'Field' + elementId;
                        elementId++;
                    } else if (fieldType === 'textarea') {
                        element.ElementId = 'Field' + elementId;
                        element.fieldName = $('#' + fieldId + '_fieldName').val() || 'שדה טקסט ארוך';
                        element.Rows = parseInt($('#' + fieldId + '_rows').val()) || 3;
                        element.Width = parseInt($('#' + fieldId + '_width').val()) || 80;
                        element.MaxLength = parseInt($('#' + fieldId + '_maxLength').val()) || 500;
                        element.Mandatory = $('#' + fieldId + '_mandatory').is(':checked');
                        element.DbName = 'Field' + elementId;
                        elementId++;
                    } else if (fieldType === 'Select') {
                        element.ElementId = 'Field' + elementId;
                        element.fieldName = $('#' + fieldId + '_fieldName').val() || 'תפריט נפתח';
                        element.Width = parseInt($('#' + fieldId + '_width').val()) || 40;
                        element.Mandatory = $('#' + fieldId + '_mandatory').is(':checked');
                        element.DbName = 'Field' + elementId;

                        var optionsText = $('#' + fieldId + '_options').val() || 'אופציה 1\nאופציה 2\nאופציה 3';
                        console.log('Select field:', fieldId, 'Options text:', optionsText); // debug
                        // ניקוי שורות ריקות ורווחים מיותרים
                        var cleanOptions = optionsText.split('\n').filter(function(option) {
                            return option.trim() !== '';
                        }).map(function(option) {
                            return option.trim();
                        });
                        element.SelectVal = cleanOptions.join(',');
                        console.log('Select final value:', element.SelectVal); // debug
                        elementId++;
                    } else if (fieldType === 'CheckBox') {
                        element.ElementId = 'Field' + elementId;
                        element.fieldName = $('#' + fieldId + '_fieldName').val() || 'צ\'קבוקס חדש';
                        element.Width = parseInt($('#' + fieldId + '_width').val()) || 40;
                        element.Mandatory = $('#' + fieldId + '_mandatory').is(':checked');
                        element.DbName = 'Field' + elementId;
                        elementId++;
                    } else if (fieldType === 'Radio') {
                        element.ElementId = 'Field' + elementId;
                        element.fieldName = $('#' + fieldId + '_fieldName').val() || 'רדיו חדש';
                        element.Width = parseInt($('#' + fieldId + '_width').val()) || 40;
                        element.Mandatory = $('#' + fieldId + '_mandatory').is(':checked');
                        element.DbName = 'Field' + elementId;
                        element.RadioType = 'Radio2'; // ברירת מחדל להצגה בשורה אחת

                        var optionsText = $('#' + fieldId + '_options').val() || 'אופציה 1\nאופציה 2\nאופציה 3';
                        console.log('Radio field:', fieldId, 'Options text:', optionsText); // debug
                        var optionsArray = optionsText.split('\n');
                        element.RadioBt = [];
                        for (var i = 0; i < optionsArray.length; i++) {
                            // בדיקה שהשורה לא ריקה ולא רק רווחים
                            if (optionsArray[i].trim() !== '') {
                                element.RadioBt.push({ Text: optionsArray[i].trim() });
                            }
                        }
                        console.log('Radio final RadioBt:', element.RadioBt); // debug
                        elementId++;
                    }

                    formBuilderElements.push(element);
                }
            });

            if (formBuilderElements.length === 0) {
                $('#MainForm').html('<div style="text-align:center;color:#999;padding:20px;">לא נוספו שדות עדיין</div>');
                return;
            }

            CreateFormElements(formBuilderElements, 'MainForm');
        }

        // פונקציה לשמירת הטופס
        function saveForm() {
            generatePreview(); // וודא שהנתונים מעודכנים

            // הצגת הלואדר
            $("#FixedWaiting").show();

            var exportData = {
                FormElements: formBuilderElements,
                TofesId: "0",
                Version: "",
                AllowChanges: false,
                NeedSign: $('#requireSignature').is(':checked'),
                PreData: false,
                MosadId: "0",
                MainLogo: "",
                MainTitle: $('#formTitle').val() || 'מחולל הטפסים',
                SpecialCheck: "",
                DeveloperNotes: $('#developerNotes').val() || ""
            };

            // שליחה לשרת
            $.ajax({
                url: "https://script.google.com/macros/s/AKfycbxC6AM89xarrOF7WyDTMiQZJcml0yLnKe0EBUuXP6N_XG6gOX7wAQ3Of8NCw1k9c2ma/exec", // כתובת השרת
                type: "POST",
                data: { payload: JSON.stringify(exportData) }, // שלח כשדה בשם payload

                // contentType: "application/json",
                success: function (response) {
                    // הסתרת הלואדר
                    $("#FixedWaiting").hide();
                    var BtTex = 'חזרה לנדרים פלוס'
                    if (MasofId == '') BtTex = 'אישור'
                    swal({
                        title: "הטופס נשלח בהצלחה",
                        type: "success",
                        showCancelButton: false,
                        confirmButtonText: BtTex,
                        closeOnConfirm: true,
                        allowOutsideClick: false,
                    }, function (isConfirm) {
                        if (MasofId !== '') { parent.GoToMenu("Tafrit"); parent.closeIFrame() } else { $('html, body').scrollTop(0); location.reload(); }
                    });
                },
                error: function () {
                    // הסתרת הלואדר
                    $("#FixedWaiting").hide();
                    alert("שגיאה בשמירת הטופס");
                }
            });
        }

        // פונקציה לייצא את הטופס כ-JSON (להשאיר לצורך פיתוח)
        function exportFormAsJSON() {
            generatePreview(); // וודא שהנתונים מעודכנים

            var exportData = {
                FormElements: formBuilderElements,
                TofesId: "0",
                Version: "",
                AllowChanges: false,
                NeedSign: $('#requireSignature').is(':checked'),
                PreData: false,
                MosadId: "0",
                MainLogo: "",
                MainTitle: $('#formTitle').val() || 'מחולל הטפסים',
                SpecialCheck: "",
                DeveloperNotes: $('#developerNotes').val() || ""
            };

            // הצגת ה-JSON בחלון popup
            var jsonString = JSON.stringify(exportData, null, 2);
            alert("JSON של הטופס:\n\n" + jsonString);

            // העתקה ללוח
            if (navigator.clipboard) {
                navigator.clipboard.writeText(jsonString).then(function () {
                    console.log('JSON copied to clipboard');
                });
            }
        }

        // פונקציה לחילוף טאבים
        function switchTab(tabName) {
            // הסרת הקלאס active מכל הכפתורים והתוכן
            $('.tab-button').removeClass('active');
            $('.tab-content').removeClass('active');

            // הוספת הקלאס active לכפתור ותוכן הנוכחיים
            $('button[onclick="switchTab(\'' + tabName + '\')"]').addClass('active');
            $('#' + tabName + '-tab').addClass('active');
        }

        $(document).ready(function () {
            $.ajaxSetup({ cache: false });


            if (Json.MainLogo !== '') { $("#MainLogo").attr('src', Json.MainLogo); } else { $("#MainLogo").attr('src', 'https://images.matara.pro/ClientsImages/' + Json.MosadId + '.jpg?1'); }
            $("#MainTitle").html(Json.MainTitle);

            //AddClientLogin("1");

            if (GetURLParameter("Demo") == '1') Demo = "&Demo=1";
            MasofId = GetURLParameter("MasofId");
            ClientId = GetURLParameter("ClientId");
            Zeout = GetURLParameter("Zeout");

            if (GetURLParameter("Admin") == '1') $("#AdminBt").show();
            if (MasofId !== '') {
                $("#BackToNedarim").show();
                //$("#NoteClose").show();
                //$("#WaitDiv2").hide();
                //return false;
            }


            if (Json.NeedSign == true) $("#SignAlert").show();


            // יצירת הטופס באמצעות הפונקציה החדשה
            CreateFormElements(Json.FormElements, 'MainForm');

            // הגדרת תצוגה ראשונית ליוצר הטפסים
            $('#MainForm').html('<div style="text-align:center;color:#999;padding:20px;">לא נוספו שדות עדיין</div>');

            // הוספת event listeners להגדרות כלליות
            $('#formTitle, #requireLogin, #requireSignature, #developerNotes').on('input change', function () {
                setTimeout(generatePreview, 50);
            });

            // הוספת event delegation גלובלי יחיד לכל השדות
            $(document).on('input change keyup paste', '#fieldsList input, #fieldsList textarea, #fieldsList select', function() {
                console.log('Event triggered on:', $(this).attr('id'), 'Value:', $(this).val()); // debug
                // תגובה מהירה יותר לשדות אופציות
                var isOptionsField = $(this).attr('id') && ($(this).attr('id').endsWith('_options') || $(this).attr('id').endsWith('_listItems'));
                var delay = isOptionsField ? 10 : 50;
                
                // עבור שדות אופציות, נעביר את הערך החדש ישירות
                if (isOptionsField) {
                    var currentElement = $(this);
                    setTimeout(function() {
                        generatePreviewWithNewValue(currentElement.attr('id'), currentElement.val());
                    }, delay);
                } else {
                    setTimeout(generatePreview, delay);
                }
            });

            $("#WaitDiv2").hide()
            $("#AllMainForm").show()
            // if (Json.AllowChanges == true && ClientId !== '' && Zeout !== '') {
            //     GetOldTofesData();
            // }



            AutoFillMail("Mail")



            // listCityGetAllCity({
            //     CityId: '#City',
            //     StreetId: '#Street',
            //     Auto_Focus_After_City_Selection: true,
            //     list_Citys: []
            // })






            //Special_Check()

            // Check_Tofes_Version("AllMainForm")


        });




        function GetTofesSettings() {
            $.ajax({
                url: "Manage.aspx?Action=GetTofesSettings&TofesId=" + Json.TofesId + "&MosadId=" + Json.MosadId,
                type: 'POST',
                context: Text,
                timeout: 180000,
            }).success(function (JsonData) {


                try {
                    for (var i = 0; i < JsonData.length; i++) {
                        JsonData[i] = Response[i].Data

                        if (JsonData[i].split('ǂ')[4] !== "") {
                            Notes_Txt += '<li style="margin-bottom: 10px;">' + Response[i].split('ǂ')[4].replace(/&/g, '<br />').trim() + '</li>';
                        }

                    }


                    for (var Elem in JsonData) {
                        NatsigArray[+JsonData[Elem].Data.split('ǂ')[0]] = {
                            "Name": JsonData[Elem].Data.split('ǂ')[1],
                            "Nikud_Total": JsonData[Elem].Data.split('ǂ')[2]
                        }
                    }

                    if (Notes_Txt !== "") {
                        $('#Notfication_Div').show();
                        $('#Notfication').html(Notes_Txt);
                    }


                    $("#WaitDiv2").hide()
                    $("#AllMainForm").show()

                } catch (e) {
                    console.log(e)
                    EAlertConfirm("שגיאה בקבלת נתונים, יש לפנות לאחראי.");
                    $("#WaitDiv2").html('<div style="font-size: 19px;text-align: center;color: indianred; font-weight: bold;font-family: Assistant;margin-top: 40px;margin-bottom: 50px;"><span style="font-size:24px">שגיאה בקבלת נתונים, יש לפנות לאחראי.</div>');
                    return false;
                }




            }).error(function () {
                EAlertConfirm("שגיאה בקבלת נתונים. בדוק תקשורת")
                $("#WaitDiv2").html('<div style="font-size: 19px;text-align: center;color: indianred; font-weight: bold;font-family: Assistant;margin-top: 40px;margin-bottom: 50px;"><span style="font-size:24px">שגיאה בקבלת נתונים. בדוק תקשורת.</div>');
                return false;
            });

        }



        function GetOldTofesData() {

            if (Json.AllowChanges !== true) {
                GetPreData();
                return false;
            }

            if (parent.ClientJson) {
                ClientJson = parent.ClientJson;
            }

            $("#AllMainForm").hide();
            $("#WaitDiv2").show()
            $.ajax({
                url: "Manage.aspx?Action=GetOldTofesData&MosadId=" + Json.MosadId + "&TofesId=" + Json.TofesId,
                data: "SessionId=" + encodeURIComponent(ClientJson.SessionId) + "&SessionPass=" + encodeURIComponent(ClientJson.SessionPass) + "&ClientId=" + encodeURIComponent(ClientJson.ID),
                type: 'POST',
                context: Text,
                timeout: 60000,
            }).success(function (JsonData) {
                $("#WaitDiv2").hide()
                $("#AllMainForm").show();

                if (JsonData.Status == 'Error' && JsonData.Message == 'NOT FOUND') {
                    return false;
                }

                OldTofesId = JsonData.ID;
                $("#EditNote").show();

                for (var Element in Json.FormElements) {
                    var JsonElement = Json.FormElements[Element]
                    if (JsonElement.DbName !== undefined) {

                        if (JsonElement.Type == 'CheckBox') {
                            if (JsonData[JsonElement.DbName] == "מסומן") { $("#" + JsonElement.ElementId).prop('checked', true); }
                        } else if (JsonElement.Type == 'Radio') {
                            for (i = 0; i < JsonElement.RadioBt.length; i++) {
                                if (JsonElement.RadioBt[i].Text == JsonData[JsonElement.DbName]) { $("#" + JsonElement.ElementId + '_Radio' + i).prop('checked', 'checked') }
                            }
                        } else {
                            $("#" + JsonElement.ElementId).val(JsonData[JsonElement.DbName])
                        }

                    }

                }
                Calculate()
            }).error(function () {

                var BtTex = 'חזרה לנדרים פלוס'
                if (MasofId == '') BtTex = 'אישור'
                swal({
                    title: "שגיאה בקבלת נתונים. בדוק תקשורת",
                    type: "error",
                    showCancelButton: false,
                    confirmButtonText: BtTex,
                    closeOnConfirm: true,
                    allowOutsideClick: false,
                }, function (isConfirm) {
                    if (MasofId !== '') { parent.GoToMenu("Tafrit"); parent.closeIFrame() } else { $('html, body').scrollTop(0); location.reload(); }
                });

            });
        }



        function UpdateClick() {
            if (MasofId !== '') parent.UpdateClick()
        }


        function Calculate() {


        }



        function ScrollUp(Input) {
            if ($(Input).val() !== undefined) {
                $('html, body').animate({ scrollTop: $(Input).position().top - 200 }, 'slow');
            }
        }


        function SendData() {


            if (true) { IAlertConfirm("זהו טופס בבניה. לא ניתן לבצע שליחה."); return false; }

            $("#SaveDiv").hide()
            $("#WaitDiv").show()


            var PostData = ''
            for (var Element in Json.FormElements) {
                var JsonElement = Json.FormElements[Element]
                if (JsonElement.Type == "Margin" || JsonElement.Type == "List" || JsonElement.Type == "Koteret") { continue; }
                if (JsonElement.ElementId == undefined) { continue; }

                var ElementValue
                var ElementVisible = true
                var ErrorTitle = "חובה לסמן: ";

                if (JsonElement.Type == "Radio") {
                    ElementValue = $('input[name=' + JsonElement.ElementId + ']:checked').val();
                    if (ElementValue == undefined) { ElementValue = '' };
                } else if (JsonElement.Type == "CheckBox") {
                    ElementValue = ($("#" + JsonElement.ElementId).is(":checked") ? "מסומן" : "")
                } else if (JsonElement.Type == "Select") {
                    ElementValue = $("#" + JsonElement.ElementId + " option:selected").val()
                    if (ElementValue == undefined) { ElementValue = '' };
                } else {
                    ErrorTitle = "חובה למלא: "
                    ElementValue = $("#" + JsonElement.ElementId).val().trim()
                };

                ElementVisible = IsVisible(JsonElement.ElementId)
                if (Json.AllowChanges == false && ((ElementVisible == false || (ElementValue == '' && JsonElement.Mandatory == false)) && JsonElement.Send !== true)) { continue; };


                if (JsonElement.Mandatory == true && ElementValue == '' && ElementVisible == true) {
                    swal({
                        type: "error",
                        title: ErrorTitle + JsonElement.fieldName,
                        showConfirmButton: true,
                        allowOutsideClick: false,
                    }, function () {
                        $('#' + JsonElement.ElementId).focus()
                        $('#' + JsonElement.ElementId).select();
                        ScrollUp('#' + JsonElement.ElementId)
                        setTimeout(function () {
                            $("#SaveDiv").show()
                            $("#WaitDiv").hide()
                        }, 100);
                    });
                    return false;
                }

                if (JsonElement.Type == 'Tel' && ElementValue !== '' && $.isNumeric(ElementValue.replace(/-/g, "")) == false && $.isNumeric(ElementValue.replace(/\//g, "")) == false) {
                    swal({
                        type: "error",
                        title: "בשדה " + JsonElement.fieldName + " יש להזין ספרות בלבד",
                        showConfirmButton: true,
                        allowOutsideClick: false,
                    }, function () {
                        $('#' + JsonElement.ElementId).focus()
                        $('#' + JsonElement.ElementId).select();

                        setTimeout(function () {
                            $("#SaveDiv").show()
                            $("#WaitDiv").hide()
                        }, 100);
                    });
                    return false;
                }
                if (JsonElement.MinLenght !== undefined && ElementValue !== '' && ElementValue.length < JsonElement.MinLenght) {
                    swal({
                        type: "error",
                        title: "בשדה " + JsonElement.fieldName + " יש להזין לפחות " + JsonElement.MinLenght + " תווים",
                        showConfirmButton: true,
                        allowOutsideClick: false,
                    }, function () {
                        $('#' + JsonElement.ElementId).focus()
                        $('#' + JsonElement.ElementId).select();
                        setTimeout(function () {
                            $("#SaveDiv").show()
                            $("#WaitDiv").hide()
                        }, 100);
                    });
                    return false;
                }

                if (JsonElement.DbName == undefined) { continue; }
                PostData = PostData + "&" + JsonElement.DbName + "=" + encodeURIComponent(htmlEncode(ElementValue)) + "&" + JsonElement.DbName + "_Name=" + encodeURIComponent(JsonElement.fieldName.replace(/<b>/g, '').replace(/<\/b>/g, ''))




            }
            PostData = PostData.substring(1, PostData.length)



            if (Json.NeedSign == true) {
                if (SignData == "") { $('#SignPad').show(); return false; }
                PostData += "&SignData=" + encodeURIComponent(SignData)
            }


            $.ajax({
                url: "Manage.aspx?Action=AddData&AjaxId=" + $.now() + "&MosadId=" + Json.MosadId + "&TofesId=" + Json.TofesId + "&Version=" + Json.Version + "&MasofId=" + MasofId + "&ClientId=" + ClientId + "&OldTofesId=" + OldTofesId + "&SpecialCheck=" + encodeURIComponent(Json.SpecialCheck) + "&MainTitle=" + encodeURIComponent(htmlEncode(Json.MainTitle)),
                context: Text,
                timeout: 32000,
                type: "POST",
                data: PostData,
            }).success(function (JsonData) {
                if (JsonData.Status !== 'OK') {

                    if (JsonData.Message == 'הטופס לא מעודכן, יש לרענן את הדף.') {
                        swal({
                            type: "error",
                            title: JsonData.Message,
                            showConfirmButton: true,
                            allowOutsideClick: false,
                            confirmButtonText: 'רענן את הדף'
                        }, function () {
                            $('html, body').scrollTop(0); location.reload();
                        });
                        return false;
                    }

                    if (JsonData.Status !== undefined) {
                        var FiledId
                        for (var Element in Json.FormElements) {
                            var JsonElement = Json.FormElements[Element]
                            if (JsonElement.Koteret == undefined) { if (JsonElement.DbName == JsonData.FieldId) FiledId = JsonElement.ElementId }
                        }

                        swal({
                            type: "error",
                            title: JsonData.Message,
                            showConfirmButton: true,
                            allowOutsideClick: false,
                        }, function () {
                            $('#' + FiledId).focus()
                            $('#' + FiledId).select();
                            setTimeout(function () {
                                $("#SaveDiv").show()
                                $("#WaitDiv").hide()
                            }, 100);
                        });
                        return false;
                    } else {
                        $("#AllMainForm").html('<div style="font-size: 19px;text-align: center;color: indianred; font-weight: bold;font-family: Assistant;margin-top: 40px;margin-bottom: 50px;"><span style="font-size:24px">שגיאה כללית. יש ליצור קשר עם מוקד שירות לקוחות<br /></div>');
                        EAlertConfirm("שגיאה כללית. יש ליצור קשר עם מוקד שירות לקוחות")
                        $("#WaitDiv").hide()
                    }

                }
                else {
                    $("#WaitDiv").hide();
                    var BtTex = 'חזרה לנדרים פלוס'
                    if (MasofId == '') BtTex = 'אישור'
                    swal({
                        title: "הטופס נשלח בהצלחה",
                        html: true,
                        // text: JsonData.Message, //מספר טופס
                        // text: '<div><div>הזמנת הכרטיסים נקלטה בהצלחה</div><div></div><div></div></div>',
                        type: "success",
                        showCancelButton: false,
                        confirmButtonText: BtTex,
                        closeOnConfirm: true,
                        allowOutsideClick: false,
                    }, function (isConfirm) {
                        if (MasofId !== '') { parent.GoToMenu("Tafrit"); parent.closeIFrame() } else { $('html, body').scrollTop(0); location.reload(); }
                    });


                }

            }).error(function () {
                EAlertConfirm("שגיאה בקבלת נתונים. בדוק תקשורת")
                $("#SaveDiv").show()
                $("#WaitDiv").hide()
            });
        }

    </script>
</head>

<body dir="rtl" style="background-color: #eee;-webkit-user-select: none;" onscroll="UpdateClick()"
    oninput="UpdateClick()">

    <!-- לואדר לשמירה -->
    <div id="FixedWaiting"
        style="width: 100%; height: 100vh; top: 0; left: 0; position: fixed; z-index: 101; background: rgba(66 ,66 ,66 ,0.47);display:none;">
        <img style="position: absolute; background: white; border-radius: 20%; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 75px; height: 75px;"
            src="waitnew.gif" alt="waiting" />
    </div>

    <!-- קונטיינר עבור שני הטפסים -->
    <div
        style="display: flex; gap: 10px; justify-content: center; align-items: flex-start; flex-wrap: wrap; padding: 10px;">

        <!-- טופס יוצר הטפסים החדש - ראשון -->
        <div style="max-width: 600px; width: 100%;">
            <div
                style="text-align:right;background-color:white;border-radius:10px;margin-top:10px;width:92%;margin-left:auto;margin-right:auto;padding-top:20px;">
                <div style="text-align:center;margin:20px;color:#2B3A63;">
                    <h2>יוצר טפסים</h2>
                </div>
                <hr style="margin-right:20%;margin-left:20%" />

                <div id="FormBuilder" style="margin-top:30px;">

                    <!-- כפתור שמירה מרכזי -->
                    <div style="text-align:center;margin-bottom:20px;">
                        <button onclick="saveForm()"
                            style="background-color:#28a745;color:white;border:none;padding:15px 30px;border-radius:8px;cursor:pointer;font-size:18px;font-weight:bold;box-shadow:0 2px 4px rgba(0,0,0,0.2);">
                            💾 שמור טופס
                        </button>
                    </div>

                    <!-- מערכת טאבים -->
                    <div class="tab-container" style="margin-bottom: 20px;">
                        <div class="tab-buttons">
                            <button class="tab-button active" onclick="switchTab('general')">הגדרות כלליות</button>
                            <button class="tab-button" onclick="switchTab('fields')">הגדרות שדות</button>
                        </div>

                        <!-- טאב הגדרות כלליות -->
                        <div id="general-tab" class="tab-content active">
                            <div style="padding: 15px;">
                                <h3 style="color:#38c232;margin-bottom:20px;font-size:18px;text-align:center;">⚙️ הגדרות
                                    כלליות של הטופס</h3>

                                <div style="margin-bottom:15px;">
                                    <label style="display:block;margin-bottom:5px;font-weight:bold;color:#2B3A63;">כותרת
                                        הטופס:</label>
                                    <input type="text" id="formTitle"
                                        style="width:calc(100% - 10px);padding:10px;border:2px solid #38c232;border-radius:5px;margin-left:5px;margin-right:5px;font-size:16px;"
                                        placeholder="הזן כותרת לטופס" value="מחולל הטפסים">
                                </div>

                                <!-- <label style="display:flex;align-items:center;cursor:pointer;margin-bottom:15px;">
                                    <input type="checkbox" id="requireLogin" style="margin-left:8px;">
                                    <span style="color:#2B3A63;font-weight:bold;">דרוש התחברות עם חשבון נדרים
                                        פלוס</span>
                                </label> -->

                                <label style="display:flex;align-items:center;cursor:pointer;margin-bottom:15px;">
                                    <input type="checkbox" id="requireSignature" style="margin-left:8px;">
                                    <span style="color:#2B3A63;font-weight:bold;">דרוש חתימה</span>
                                </label>

                                <div style="margin-bottom:15px;">
                                    <label style="display:block;margin-bottom:5px;font-weight:bold;color:#2B3A63;">הערות
                                        למפתחים:</label>
                                    <textarea id="developerNotes"
                                        style="width:calc(100% - 10px);height:60px;padding:10px;border:2px solid #38c232;border-radius:5px;margin-left:5px;margin-right:5px;resize:vertical;"
                                        placeholder="אם אתם רוצים שדות שיוסתרו לפי תנאים מסוימים, או חישובים אוטומטיים בשדות, כאן זה המקום ;)"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- טאב הגדרות שדות -->
                        <div id="fields-tab" class="tab-content">
                            <div style="">
                                <h3 style="color:#38c232;margin-bottom:20px;font-size:18px;text-align:center;">📝 הוספה
                                    ועריכת שדות</h3>

                                <!-- רשימת השדות -->
                                <div id="fieldsList" style="margin-bottom:20px;">
                                    <!-- כאן יופיעו השדות שנוספו -->
                                </div>

                                <!-- כפתור הוספת שדה חדש - מועבר למטה -->
                                <div style="text-align:center;margin-bottom:20px;">
                                    <button onclick="addNewField()"
                                        style="background-color:#38c232;color:white;border:none;padding:12px 24px;border-radius:6px;cursor:pointer;font-size:16px;font-weight:bold;">
                                        + הוסף שדה חדש
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div> <!-- סוגר דיב יוצר הטפסים -->

        <!-- דיב עוטף את כל התוכן הקיים - שני -->
        <div style="max-width: 600px; width: 100%;">

            <!--כפתורים עליונים-->
            <div id="BackToNedarim" style="text-align:center;margin-top:10px;display:none"> <input class="Bt"
                    style="background-color:#ff6a00;display:inline-block;min-width:40%;padding:8px" type="button"
                    value="חזרה לנדרים פלוס" id="BackToNedarimBottom"
                    onclick="if (MasofId !== '') parent.closeIFrame()" />
            </div>
            <div id="AdminBt" style="text-align:center;margin-top:10px;display:none">
                <input class="Bt"
                    style="background-color:#006400;display:inline-block;min-width:20%;padding:8px;cursor:pointer"
                    type="button" value="ייצוא לאקסל" onclick="GetExcel()" />
                <input class="Bt"
                    style="background-color:indianred;display:inline-block;min-width:20%;padding:8px;cursor:pointer"
                    type="button" value="איפוס המאגר" onclick="ResetForm()" />
                <div style="width:50%;font-size:0px;max-width:300px;margin-right:auto;margin-left:auto">
                    <!--מצב טופס-->
                    <div
                        style="margin-top:10px;margin-bottom:5px;padding:3px 0px;background-color:white; border-radius:5px;width:100%;text-align:center;margin-right:auto;margin-left:auto;font-size:small;color:#2B3A63;font-weight:bold">
                        מצב טופס:</div>
                    <input class="Bt"
                        style="background-color:#38C232;display:inline-block;width:48%;margin-left:2%;padding:8px;cursor:pointer"
                        type="button" value="פעיל" onclick="EnableForm('True')" />
                    <input class="Bt"
                        style="background-color:#e60a00;display:inline-block;width:48%;margin-right:2%;padding:8px;cursor:pointer"
                        type="button" value="לא פעיל" onclick="EnableForm('False')" />
                </div>
            </div>

            <!--כל הטופס הקיים-->
            <div
                style="text-align:right;background-color:white;border-radius:10px;margin-top:10px;width:92%;margin-left:auto;margin-right:auto;padding-bottom:20px;padding-top:20px;">
                <div style="text-align:center;min-height:158px;font-size:0px"><img id="MainLogo"
                        style="max-height: 180px; max-width: 100%; border-radius: 0px;"
                        src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" /></div>
                <div style="text-align:center;margin:20px;color:#2B3A63;">
                    <h2 id="MainTitle"> </h2>
                </div>
                <hr style="margin-right:20%;margin-left:20%" />
                <div style="text-align:center;margin:40px;color:#808080;" id="WaitDiv2"><img src="waitnew.gif"
                        style="width:50px;" /><br />נא להמתין. בודק אם קיימים נתונים...</div>


                <div id="NoteClose"
                    style="color: indianred; font-size: 20px; width: 370px; margin-left: auto; margin-right: auto; border: 2px solid indianred; border-radius: 7px; margin-top: 70px; padding: 13px; text-align: center; font-weight: bold; margin-bottom: 200px; max-width: 90%; padding: 20px; display: none">
                    <div style="font-size: 23px;margin-bottom: 7px;">שימו לב!</div>
                    <div>לא ניתן לגשת לטופס זה מעמדות נדרים.</div>
                </div>


                <div id="AllMainForm" style="display:none;">

                    <div id="EditNote"
                        style="text-align:center;font-size:18px;color:indianred;font-weight:bold;display:none;">
                        <span style="font-size:24px;">שים לב!</span><br /> טופס זה במצב עריכה.<br /> בעת שליחת הטופס,
                        הנתונים
                        שתזינו יחליפו את הקודמים.
                    </div>


                    <div
                        style="display: none; text-align: center; margin-top: 20px; color: #876606; font-size: 21px; font-weight: bold; width: 90%; margin: 20px auto 0px; ">
                        כותרת
                    </div>


                    <div id="MainForm" style="margin-right:20px;margin-top:30px; "></div>


                    <div id="SignDiv"
                        style="display:none;width:200px;border:1px solid #b9b6b6;border-radius:5px;cursor:pointer;margin: 30px auto 0px  auto;padding:5px;font-size:small;color:#808080">
                        חתימה:
                        <img id="SignPreview" style="width:100%;height:120px;display:block"
                            onclick="$('#SignPad').show()"
                            src='data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=' />
                    </div>

                    <div style="text-align:center;margin:40px" id="SaveDiv"><span id="SignAlert"
                            style="font-size:small;color:#808080;display:none">לפני שליחת הטופס יפתח חלון לחתימה
                            דיגיטלית</span><br /><input class="Bt" type="button" value="שלח טופס"
                            onclick="SendData()" />
                    </div>
                    <!-- br before span -->
                    <div style="text-align:center;margin:40px;color:#808080;display:none" id="WaitDiv"><img
                            src="waitnew.gif" style="width:50px;" /><br />שומר נתונים</div>
                    <!--נא להמתין. מבצע הזמנה...-->


                    <div style="height:200px"></div>


                </div>

            </div> <!-- סוגר דיב עוטף הטופס הקיים -->

        </div> <!-- סוגר קונטיינר שני הטפסים -->

        <div id="SignPad" class="modal">
            <div class="modal-content" style="max-width:600px;width:97%;padding:0px;margin: 100px auto;">
                <div id="MasavSignDiv" dir="rtl" style="text-align:center">
                    <div style="margin:15px;font-weight:bold;font-size:medium;color:cadetblue">נא לחתום כעת על המסך.
                    </div>
                    <canvas id="CanvasSign"
                        style="display: block; border: 2px solid cadetblue; border-radius: 5px; margin-right: auto; margin-left: auto"
                        width="500" height="300"></canvas>
                    <div style="padding:20px"><input type="button" class="Bt" value="איפוס חתימה"
                            style="background-color:#b9b6b6;"
                            onclick="signaturePad.clear(); SignData = ''; $('#SignPreview').attr('src', 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=')" /><input
                            type="button" class="Bt" value="אישור"
                            onclick="    $('#SignDiv').show(); $('#SignPad').hide(); if (signaturePad.isEmpty() == false) { SignData = signaturePad.toDataURL(); $('#SignPreview').attr('src', SignData); SendData() } else { $('#SignDiv').hide(); SignCancel() }" /><input
                            type="button" class="Bt" value="ביטול" style="background-color:#fc8253"
                            onclick="    SignCancel()" /></div>
                </div>
            </div>
        </div>



        <!-- <div id="SecurityLogo"
        style="text-align:center;width:98%; max-width:400px;margin-left:auto;margin-right:auto;user-select:none"><img
            src="Files/Pic/Security.PNG" style="width:70%" /></div>


    <div id="FooterLogo"
        style="text-decoration:none;padding:20px;padding-top:5px;padding-bottom:5px;margin-bottom:20px;color:gray;width: 200px;border-radius:5px;opacity:0.7;margin-left : auto; margin-right: auto;text-align:center;font-size:75%;">
        <img src="nedarim.png" /><br />מופעל באמצעות<br /><strong>נדרים פלוס מבית מטרה הפקות</strong><br />לשיווק
        ותמיכה: 03-7630543<br />
    </div> -->

        <script src="Files/signature_pad.js"></script>
        <script src="Files/app.js"></script>
        <script type="text/javascript" src="Files/FormsFunction.js"></script>





</body>

</html>